import{_ as P,y as F,r as g,z as I,o as S,D as M,b as D,f as e,j as d,v as s,G as C,l as $,m as l,a as B}from"./index-TO8iFplr.js";const T={class:"procctrl-page"},Q={class:"grid grid-4"},j={class:"field-set"},L={class:"field-set"},R={class:"field-set"},Y={class:"field-set"},z={class:"grid grid-5"},A={class:"field-set"},E={class:"field-set"},G={class:"field-set"},H={class:"field-set"},J={class:"field-set"},O={class:"grid grid-4"},W={class:"field-set"},K={class:"field-set"},X={class:"field-set"},Z={class:"field-set"},h={class:"grid grid-4"},tt={class:"field-set"},rt={class:"field-set"},et={class:"field-set"},nt={class:"field-set"},ot=["readonly"],dt={class:"grid grid-3"},st={class:"field-set"},it=["readonly"],lt={class:"field-set"},pt=["readonly"],_t={class:"field-set"},at=["value"],ut={class:"grid grid-3"},mt={class:"field-set"},ct={class:"field-set"},yt={class:"field-set"},vt={class:"actions-centered"},qt=["disabled"],bt={__name:"procCtrl",setup(ft){const t=F({prcs_prog_precon_id:"",prod_drct_id:"",prod_drct_nm:"",prcs_id:"",prcs_nm:"",prcs_ord:"",prdt_id:"",prdt_nm:"",prdt_opt_id:"",opt_nm:"",eqm_id:"",eqm_nm:"",mold_id:"",mold_nm:"",cavity:"",drct_qy:"",not_inpt_qy:"",prev_inpt_qy:"",curr_inpt_qy:"",prod_qy:"",ng_qy:"",ok_qy:"",emp_id:"",emp_nm:"",work_start_dt:"",work_end_dt:""}),v=C(),_=$(),u=g(!1),m=g(!1);function p(o){if(o==null)return NaN;const r=String(o).replace(/,/g,"").trim(),n=Number(r);return Number.isFinite(n)?n:NaN}function N(){const o=v.query||{};t.prcs_prog_precon_id=o.prcs_prog_precon_id||"",t.prod_drct_id=o.prod_drct_id||"",t.prod_drct_nm=o.prod_drct_nm||"",t.prcs_id=o.prcs_id||"",t.prcs_nm=o.prcs_nm||"",t.prcs_ord=o.prcs_ord||"",t.prdt_id=o.prdt_id||"",t.prdt_nm=o.prdt_nm||"",t.prdt_opt_id=o.prdt_opt_id||"",t.opt_nm=o.opt_nm||"",t.eqm_id=o.eqm_id||"",t.eqm_nm=o.eqm_nm||"",t.mold_id=o.mold_id||"-",t.mold_nm=o.mold_nm||"-",t.cavity=o.cavity||"-",t.drct_qy=o.drct_qy||"",t.prev_inpt_qy=o.prev_inpt_qy||"";const r=Number(t.drct_qy),n=Number(t.prev_inpt_qy);t.not_inpt_qy=Number.isFinite(r)&&Number.isFinite(n)?String(r-n):"",t.curr_inpt_qy="",t.prod_qy="",t.ng_qy="",t.ok_qy="",t.emp_id=o.emp_id||"",t.emp_nm=o.emp_nm||"",t.work_start_dt="",t.work_end_dt=""}function q(){const o=new Date,r=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0"),a=String(o.getHours()).padStart(2,"0"),U=String(o.getMinutes()).padStart(2,"0"),V=String(o.getSeconds()).padStart(2,"0");return`${r}-${n}-${i} ${a}:${U}:${V}`}let c=null;async function x(){if(!u.value){if(!t.curr_inpt_qy){alert("현투입 수량을 선택하세요.");return}{const o=p(t.curr_inpt_qy);if(!!(t.mold_id&&t.mold_id!=="-")){const n=p(t.cavity),i=p(t.not_inpt_qy);if(Number.isFinite(o)&&(Number.isFinite(n)&&o>n||Number.isFinite(i)&&o>i)){alert("최대 수량을 초과하였습니다."),y();return}}else{const n=p(t.not_inpt_qy);if(Number.isFinite(o)&&Number.isFinite(n)&&o>n){alert("최대 수량을 초과하였습니다."),y();return}}}try{await l.post("/api/proc-ctrl/prestart-guard",{prcs_prog_precon_id:t.prcs_prog_precon_id,eqm_id:t.eqm_id||null,mold_id:t.mold_id&&t.mold_id!=="-"?t.mold_id:null})}catch(o){console.error("prestart-guard 실패",o),alert("정보 중복 오류"),_.push({path:"/Minsu/prcsProgPrecon"});return}if(t.mold_id&&t.mold_id!=="-")try{await l.post("/api/proc-ctrl/mold/p1",{mold_id:t.mold_id})}catch(o){console.error("금형 상태 변경(P1) 실패",o),alert("금형 상태 변경(P1)에 실패했습니다.");return}if(t.eqm_id)try{await l.post("/api/proc-ctrl/eqm/q1",{eqm_id:t.eqm_id})}catch(o){console.error("설비 상태 변경(Q1) 실패",o),alert("설비 상태 변경(Q1)에 실패했습니다.");return}if(!t.prcs_prog_precon_id){alert("대상 prcs_prog_precon_id가 없습니다. 화면으로 돌아가 다시 시도해주세요.");return}try{await l.post("/api/prcs-prog-precon/clear-status",{prcs_prog_precon_id:t.prcs_prog_precon_id})}catch(o){console.error("공정 상태 초기화 실패(st=NULL)",o),alert("공정 상태 초기화에 실패했습니다.");return}t.work_start_dt||(t.work_start_dt=q()),c||(c=setInterval(()=>{t.work_end_dt=q()},1e3)),u.value=!0,m.value=!1}}function f(){if(!u.value){_.push({path:"/Minsu/prcsProgPrecon"});return}if(!m.value){c&&(clearInterval(c),c=null),t.work_end_dt=q(),m.value=!0,t.prod_qy=String(t.curr_inpt_qy||"0");return}if(!t.emp_id){alert("작업자를 선택한 후 진행해 주세요."),_.push({path:"/Minsu/prcsProgPrecon"});return}if(!t.eqm_id){alert("설비를 선택한 후 진행해 주세요."),_.push({path:"/Minsu/prcsProgPrecon"});return}const o=Number(t.prcs_ord);if(!Number.isFinite(o)){alert("공정 순서(prcs_ord) 값이 올바르지 않습니다. 처음 화면으로 돌아갑니다."),_.push({path:"/Minsu/prcsProgPrecon"});return}const r={prcs_prog_precon_id:t.prcs_prog_precon_id||"",prcs_ord:o,mold_id:t.mold_id&&t.mold_id!=="-"?t.mold_id:null,eqm_id:t.eqm_id||null,emp_id:t.emp_id||v.query?.emp_id||null,inpt_qy:Number(t.curr_inpt_qy||0),prod_qy:Number(t.prod_qy||0),infer_qy:Number(t.ng_qy||0),pass_qy:Number(b.value||0),wk_fr_dt:t.work_start_dt,wk_to_dt:t.work_end_dt};l.post("/api/proc-ctrl/finish",r).then(()=>l.post("/api/prcs-prog-precon/recompute-quantities",{prcs_prog_precon_id:r.prcs_prog_precon_id})).then(async()=>{try{t.eqm_id&&await l.post("/api/proc-ctrl/eqm/q2",{eqm_id:t.eqm_id}),t.mold_id&&t.mold_id!=="-"&&await l.post("/api/proc-ctrl/mold/p2",{mold_id:t.mold_id})}catch(n){console.error("설비/금형 상태 원복 실패",n)}}).then(()=>l.post("/api/prcs-prog-precon/advance-next-step",{prcs_prog_precon_id:r.prcs_prog_precon_id})).then(()=>{_.push({path:"/Minsu/prcsProgPrecon"})}).catch(n=>{console.error("작업 종료 처리 실패",n);const i=n?.response?.data?.message||n?.message||"작업 종료 처리에 실패했습니다.";alert(`작업 종료 처리에 실패했습니다.
${i}`)})}const b=I(()=>{const o=Number(t.prod_qy),r=Number(t.ng_qy);return!Number.isFinite(o)||!Number.isFinite(r)?"":String(o-r)});S(()=>{N()}),M(()=>f());function k(){const o=t.curr_inpt_qy;if(!o&&o!==0)return;const r=p(o);if(!Number.isFinite(r))return;if(!!(t.mold_id&&t.mold_id!=="-")){const i=p(t.cavity),a=p(t.not_inpt_qy);(Number.isFinite(i)&&r>i||Number.isFinite(a)&&r>a)&&(alert("최대 수량을 초과하였습니다."),y())}else{const i=p(t.not_inpt_qy);Number.isFinite(i)&&r>i&&(alert("최대 수량을 초과하였습니다."),y())}}function y(){t.curr_inpt_qy=""}function w(){const o=t.prcs_prog_precon_id||"";if(!o){alert("저장할 대상(prcs_prog_precon_id)이 없습니다. 다시 시도해주세요.");return}if(!t.curr_inpt_qy){alert("현투입 수량을 선택하세요.");return}const r={prcs_prog_precon_id:o,inpt_qy:Number(t.curr_inpt_qy||0),prod_qy:Number(t.prod_qy||0),infer_qy:Number(t.ng_qy||0),pass_qy:Number(b.value||0)};l.post("/api/prcs-prog-precon/update-quantities",r).then(async()=>{const n=v.query?.prod_drct_deta_id||"",i=Number(t.curr_inpt_qy||0);if(n&&Number.isFinite(i)&&i>0)try{await l.post("/api/prcs-prog-precon/mark-run-target-j3",{prod_drct_deta_id:n,prod_expc_qy:i})}catch(a){console.error("현투입 수량 상태 J3 변경 실패",a)}}).then(()=>{alert("저장이 완료 되었습니다."),_.push({path:"/Minsu/prcsProgPrecon"})}).catch(n=>{console.error("작업 저장 실패",n),alert("작업 저장에 실패했습니다.")})}return(o,r)=>(B(),D("div",T,[e("div",Q,[e("div",j,[r[22]||(r[22]=e("div",{class:"label"},"생산 지시 ID",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=n=>t.prod_drct_id=n),readonly:""},null,512),[[s,t.prod_drct_id]])]),e("div",L,[r[23]||(r[23]=e("div",{class:"label"},"생산 지시 명",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=n=>t.prod_drct_nm=n),readonly:""},null,512),[[s,t.prod_drct_nm]])]),e("div",R,[r[24]||(r[24]=e("div",{class:"label"},"공정 ID",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=n=>t.prcs_id=n),readonly:""},null,512),[[s,t.prcs_id]])]),e("div",Y,[r[25]||(r[25]=e("div",{class:"label"},"공정 명",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[3]||(r[3]=n=>t.prcs_nm=n),readonly:""},null,512),[[s,t.prcs_nm]])])]),e("div",z,[e("div",A,[r[26]||(r[26]=e("div",{class:"label"},"설비 ID",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[4]||(r[4]=n=>t.eqm_id=n),readonly:""},null,512),[[s,t.eqm_id]])]),e("div",E,[r[27]||(r[27]=e("div",{class:"label"},"설비 명",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[5]||(r[5]=n=>t.eqm_nm=n),readonly:""},null,512),[[s,t.eqm_nm]])]),e("div",G,[r[28]||(r[28]=e("div",{class:"label"},"금형 ID",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[6]||(r[6]=n=>t.mold_id=n),readonly:""},null,512),[[s,t.mold_id]])]),e("div",H,[r[29]||(r[29]=e("div",{class:"label"},"금형 명",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[7]||(r[7]=n=>t.mold_nm=n),readonly:""},null,512),[[s,t.mold_nm]])]),e("div",J,[r[30]||(r[30]=e("div",{class:"label"},"CAVITY",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[8]||(r[8]=n=>t.cavity=n),readonly:""},null,512),[[s,t.cavity]])])]),e("div",O,[e("div",W,[r[31]||(r[31]=e("div",{class:"label"},"제품 ID",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[9]||(r[9]=n=>t.prdt_id=n),readonly:""},null,512),[[s,t.prdt_id]])]),e("div",K,[r[32]||(r[32]=e("div",{class:"label"},"제품 명",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[10]||(r[10]=n=>t.prdt_nm=n),readonly:""},null,512),[[s,t.prdt_nm]])]),e("div",X,[r[33]||(r[33]=e("div",{class:"label"},"제품 옵션 ID",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[11]||(r[11]=n=>t.prdt_opt_id=n),readonly:""},null,512),[[s,t.prdt_opt_id]])]),e("div",Z,[r[34]||(r[34]=e("div",{class:"label"},"제품 옵션 명",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[12]||(r[12]=n=>t.opt_nm=n),readonly:""},null,512),[[s,t.opt_nm]])])]),e("div",h,[e("div",tt,[r[35]||(r[35]=e("div",{class:"label"},"지시 수량",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[13]||(r[13]=n=>t.drct_qy=n),readonly:""},null,512),[[s,t.drct_qy]])]),e("div",rt,[r[36]||(r[36]=e("div",{class:"label"},"기투입 수량",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[14]||(r[14]=n=>t.prev_inpt_qy=n),readonly:""},null,512),[[s,t.prev_inpt_qy]])]),e("div",et,[r[37]||(r[37]=e("div",{class:"label"},"미투입 수량",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[15]||(r[15]=n=>t.not_inpt_qy=n),readonly:""},null,512),[[s,t.not_inpt_qy]])]),e("div",nt,[r[38]||(r[38]=e("div",{class:"label"},"현투입 수량",-1)),d(e("input",{type:"number","onUpdate:modelValue":r[16]||(r[16]=n=>t.curr_inpt_qy=n),readonly:u.value,onBlur:k},null,40,ot),[[s,t.curr_inpt_qy]])])]),e("div",dt,[e("div",st,[r[39]||(r[39]=e("div",{class:"label"},"생산량",-1)),d(e("input",{type:"number","onUpdate:modelValue":r[17]||(r[17]=n=>t.prod_qy=n),readonly:!m.value},null,8,it),[[s,t.prod_qy]])]),e("div",lt,[r[40]||(r[40]=e("div",{class:"label"},"불량량",-1)),d(e("input",{type:"number","onUpdate:modelValue":r[18]||(r[18]=n=>t.ng_qy=n),readonly:!m.value},null,8,pt),[[s,t.ng_qy]])]),e("div",_t,[r[41]||(r[41]=e("div",{class:"label"},"합격량",-1)),e("input",{type:"text",value:b.value,readonly:""},null,8,at)])]),e("div",ut,[e("div",mt,[r[42]||(r[42]=e("div",{class:"label"},"작업자",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[19]||(r[19]=n=>t.emp_nm=n),readonly:""},null,512),[[s,t.emp_nm]])]),e("div",ct,[r[43]||(r[43]=e("div",{class:"label"},"작업 시작 일시",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[20]||(r[20]=n=>t.work_start_dt=n),readonly:""},null,512),[[s,t.work_start_dt]])]),e("div",yt,[r[44]||(r[44]=e("div",{class:"label"},"작업 종료 일시",-1)),d(e("input",{type:"text","onUpdate:modelValue":r[21]||(r[21]=n=>t.work_end_dt=n),readonly:""},null,512),[[s,t.work_end_dt]])])]),e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",type:"button",onClick:x,disabled:u.value}," 작업 시작 ",8,qt),e("button",{class:"btn btn-sm btn-outline-danger",type:"button",onClick:f}," 작업 종료 "),e("button",{class:"btn btn-sm btn-outline-secondary",type:"button",onClick:w}," 작업 저장 ")])]))}},Nt=P(bt,[["__scopeId","data-v-916a746a"]]);export{Nt as default};
