import{_ as me,r as k,y as ce,z as B,q as ve,o as ye,m as x,c as R,w as l,f as n,d as t,g as d,e as _,b as L,h as $,F as I,a as g,p as Q,k as p,t as W,j as f,v as m}from"./index-TO8iFplr.js";import{u as X}from"./useDates-sS5pNIz9.js";import{r as Ce}from"./rcvordModalTwo-mV3yCMvt.js";import{_ as be}from"./rscModal-DJcEXXuo.js";const we={class:"d-flex justify-content-end gap-2 mb-2"},xe={class:"search-filter-box mb-2"},ge={class:"d-flex justify-content-end gap-2"},Ve={class:"grid-box flex-grow-1 overflow-hidden"},ke={class:"table-wrapper"},Me=["onUpdate:modelValue"],he=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],Oe=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],Se={class:"d-flex justify-content-end gap-2"},Te={class:"grid-box flex-grow-1 overflow-hidden"},ze={class:"table-wrapper"},Fe=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],qe=["onUpdate:modelValue"],Ae={__name:"bomManage",setup(Ee){const S=k(!1),T=k(!1),Y=()=>{S.value=!0},Z=()=>{T.value=!0};function ee(o){if(!o)return;const e=new Date().toISOString().slice(0,10),u={prdt_id:o.prdt_id||"",prdt_nm:o.prdt_nm||"",prdt_opt_id:o.opt_id||"",opt_nm:o.opt_nm||"",bom_ver:"v1",valid_fr_dt:e,valid_to_dt:"",st:"",rm:"",selected:!1,isNew:!0};y.value.unshift(u),M.value=0,b.value=null,S.value=!1}function te(o){if(!o||!b.value)return;const e={bom_deta_id:"",bom_id:b.value,rsc_id:o.rsc_id||"",rsc_nm:o.rsc_nm||"",spec_id:o.spec_id||"",unit_id:o.unit_id||"",rec_qy:o.rec_qy||"",rm:"",selected:!1,isNew:!0};v.value.unshift(e),h.value=0,N.value=null,T.value=!1}const c=ce({productName:"",optionName:"",status:""}),y=k([]),M=k(null),b=k(null),v=k([]),h=k(null),N=k(null),O=B(()=>y.value.slice(0,10)),le=B(()=>Math.max(0,10-O.value.length)),D=B(()=>v.value.slice(0,10)),oe=B(()=>Math.max(0,10-D.value.length));ve(y,o=>{o.forEach(e=>{e&&e.valid_fr_dt&&(e.valid_fr_dt=X.dateFormat(e.valid_fr_dt,"yyyy-MM-dd")),e&&e.valid_to_dt&&(e.valid_to_dt=X.dateFormat(e.valid_to_dt,"yyyy-MM-dd"))})},{deep:!0});const E=B(()=>O.value.length>0&&O.value.every(o=>o.selected)),P=B(()=>D.value.length>0&&D.value.every(o=>o.selected)),ae=()=>{const o=!E.value;O.value.forEach(e=>{e.selected=o})},se=()=>{const o=!P.value;D.value.forEach(e=>{e.selected=o})};ye(()=>{q()});const de=(o,e)=>{M.value=e,b.value=o.bom_id,console.log("ì¢Œì¸¡ BOM ì„ íƒ:",o.bom_id),o.bom_id&&j(o.bom_id)},ne=(o,e)=>{h.value=e,N.value=o.bom_deta_id,console.log("ìš°ì¸¡ BOM ë””í…Œì¼ ì„ íƒ:",o.bom_deta_id)},j=async o=>{try{console.log("ðŸ“‹ ìš°ì¸¡ BOM ë””í…Œì¼ ì¡°íšŒ:",o);const e=await x.get("/api/bom/detail",{params:{bom_id:o}}),u=Array.isArray(e.data)?e.data:e.data.data||[];v.value=u.map(C=>({...C,selected:!1})),console.log("âœ… ìš°ì¸¡ BOM ë””í…Œì¼ ì¡°íšŒ ì™„ë£Œ:",v.value.length,"ê±´"),h.value=null,N.value=null}catch(e){console.error("âŒ ìš°ì¸¡ BOM ë””í…Œì¼ ì¡°íšŒ ì˜¤ë¥˜:",e),v.value=[]}},q=async()=>{try{const o={productName:c.productName||"",optionName:c.optionName||"",status:c.status||""};console.log("ðŸ“‹ BOM ë§ˆìŠ¤í„° ì¡°íšŒ íŒŒë¼ë¯¸í„°:",o);const e=await x.get("/api/bom/master",{params:o}),u=Array.isArray(e.data)?e.data:e.data.data||[];y.value=u.map(C=>({...C,selected:!1})),console.log("âœ… ì¢Œì¸¡ BOM ë§ˆìŠ¤í„° ì¡°íšŒ ì™„ë£Œ:",y.value.length,"ê±´"),M.value=null,b.value=null,v.value=[]}catch(o){console.error("âŒ ì¢Œì¸¡ BOM ë§ˆìŠ¤í„° ì¡°íšŒ ì˜¤ë¥˜:",o),y.value=[],v.value=[]}},ue=()=>{c.productName="",c.optionName="",c.status="",M.value=null,b.value=null,h.value=null,N.value=null,y.value=[],v.value=[],console.log("ðŸ”„ ì´ˆê¸°í™” ì™„ë£Œ")},re=async()=>{const o=y.value.filter(e=>e.isNew||e.selected||e.bom_ver&&e.bom_ver!=="v1");if(o.length===0){alert("ì €ìž¥í•  BOM í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");return}try{for(const e of o){if(!e.prdt_nm){alert("ì œí’ˆëª…ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");continue}let u=e.prdt_id;!u&&e.prdt_nm&&(u=(await x.get("/api/product_id_by_name",{params:{prdt_nm:e.prdt_nm}})).data?.prdt_id||"");let C=e.opt_id;!C&&e.opt_nm&&(C=(await x.get("/api/option_id_by_name",{params:{opt_nm:e.opt_nm}})).data?.opt_id||"");const z=new Date().toISOString().slice(0,10),V={prdt_id:u,prdt_opt_id:C,bom_ver:e.bom_ver||"v1",valid_fr_dt:z,valid_to_dt:e.valid_to_dt||"",st:e.st||"",rm:e.rmrk||""};e.bom_id="",console.log("âž• BOM ë§ˆìŠ¤í„° ì‹ ê·œ ë“±ë¡ payload:",JSON.stringify(V,null,2)),await x.post("/api/bom/master",V)}alert("ì €ìž¥ ì™„ë£Œ"),await q()}catch(e){console.error("âŒ BOM ë§ˆìŠ¤í„° ì €ìž¥ ì˜¤ë¥˜:",e),alert("ì €ìž¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},ie=async()=>{const o=y.value.filter(e=>e.selected);if(o.length===0){alert("ì‚­ì œí•  BOM í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}if(confirm(`${o.length}ê°œ BOM í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{for(const e of o)!e.isNew&&e.bom_id&&await x.delete(`/api/bom/master/${e.bom_id}`);y.value=y.value.filter(e=>!e.selected),alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),M.value=null,b.value=null}catch{alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},pe=async()=>{if(!b.value){alert("ì¢Œì¸¡ì—ì„œ BOMì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return}const o=v.value.filter(e=>e.isNew||e.selected);if(o.length===0){alert("ì €ìž¥í•  BOM ë””í…Œì¼ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");return}try{for(const e of o){if(!e.rsc_nm){alert("ìžìž¬ëª…ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");continue}const u={bom_id:b.value,rsc_nm:e.rsc_nm,spec:e.spec||"",unit:e.unit||"",bom_qty:e.bom_qty||"",rmrk:e.rmrk||""};e.isNew?await x.post("/api/bom/detail",u):(u.bom_deta_id=e.bom_deta_id,await x.put(`/api/bom/detail/${e.bom_deta_id}`,u))}alert("ì €ìž¥ ì™„ë£Œ"),await j(b.value)}catch{alert("ì €ìž¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},_e=async()=>{const o=v.value.filter(e=>e.selected);if(o.length===0){alert("ì‚­ì œí•  BOM ë””í…Œì¼ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}if(confirm(`${o.length}ê°œ BOM ë””í…Œì¼ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{for(const e of o)!e.isNew&&e.bom_deta_id&&await x.delete(`/api/bom/detail/${e.bom_deta_id}`);v.value=v.value.filter(e=>!e.selected),alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),h.value=null,N.value=null}catch{alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}};return(o,e)=>{const u=_("CButton"),C=_("CFormLabel"),z=_("CFormInput"),V=_("CCol"),A=_("CFormSelect"),H=_("CRow"),F=_("CFormCheck"),i=_("CTableHeaderCell"),U=_("CTableRow"),G=_("CTableHead"),r=_("CTableDataCell"),J=_("CTableBody"),K=_("CTable"),fe=_("CContainer");return g(),R(fe,{fluid:"",class:"h-100 d-flex flex-column p-3"},{default:l(()=>[n("div",we,[t(u,{color:"secondary",size:"sm",onClick:q},{default:l(()=>[...e[20]||(e[20]=[d("ì¡°íšŒ",-1)])]),_:1}),t(u,{color:"secondary",size:"sm",onClick:ue},{default:l(()=>[...e[21]||(e[21]=[d("ì´ˆê¸°í™”",-1)])]),_:1})]),n("div",xe,[t(H,{class:"g-2 align-items-end"},{default:l(()=>[t(V,{md:4},{default:l(()=>[t(C,{class:"form-label"},{default:l(()=>[...e[22]||(e[22]=[d("ì œí’ˆëª…",-1)])]),_:1}),t(z,{modelValue:c.productName,"onUpdate:modelValue":e[0]||(e[0]=a=>c.productName=a),size:"sm",placeholder:"ì œí’ˆëª… ìž…ë ¥"},null,8,["modelValue"])]),_:1}),t(V,{md:4},{default:l(()=>[t(C,{class:"form-label"},{default:l(()=>[...e[23]||(e[23]=[d("ì˜µì…˜ëª…",-1)])]),_:1}),t(z,{modelValue:c.optionName,"onUpdate:modelValue":e[1]||(e[1]=a=>c.optionName=a),size:"sm",placeholder:"ì˜µì…˜ëª… ìž…ë ¥"},null,8,["modelValue"])]),_:1}),t(V,{md:3},{default:l(()=>[t(C,{class:"form-label"},{default:l(()=>[...e[24]||(e[24]=[d("ìƒíƒœ",-1)])]),_:1}),t(A,{modelValue:c.status,"onUpdate:modelValue":e[2]||(e[2]=a=>c.status=a),size:"sm"},{default:l(()=>[...e[25]||(e[25]=[n("option",{value:""},"ì „ì²´",-1),n("option",{value:"P1"},"ì‚¬ìš©",-1),n("option",{value:"P2"},"ë¯¸ì‚¬ìš©",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),t(H,{class:"flex-grow-1 overflow-hidden g-2"},{default:l(()=>[t(V,{md:6,class:"d-flex flex-column overflow-hidden gap-2"},{default:l(()=>[n("div",ge,[t(u,{color:"secondary",size:"sm",onClick:Y},{default:l(()=>[...e[26]||(e[26]=[d("ì œí’ˆ ì¡°íšŒ",-1)])]),_:1}),t(u,{color:"secondary",size:"sm",onClick:re},{default:l(()=>[...e[27]||(e[27]=[d("ì €ìž¥",-1)])]),_:1}),t(u,{color:"danger",size:"sm",onClick:ie},{default:l(()=>[...e[28]||(e[28]=[d("ì„ íƒì‚­ì œ",-1)])]),_:1})]),n("div",Ve,[n("div",ke,[t(K,{bordered:"",hover:"",class:"data-table"},{default:l(()=>[t(G,null,{default:l(()=>[t(U,null,{default:l(()=>[t(i,{style:{width:"30px"}},{default:l(()=>[t(F,{checked:E.value,onChange:ae},null,8,["checked"])]),_:1}),t(i,{style:{width:"40px"}},{default:l(()=>[...e[29]||(e[29]=[d("No",-1)])]),_:1}),t(i,{style:{width:"120px"}},{default:l(()=>[...e[30]||(e[30]=[d("BOM ID",-1)])]),_:1}),t(i,{style:{width:"120px"}},{default:l(()=>[...e[31]||(e[31]=[d("ì œí’ˆëª…",-1)])]),_:1}),t(i,{style:{width:"120px"}},{default:l(()=>[...e[32]||(e[32]=[d("ì˜µì…˜ëª…",-1)])]),_:1}),t(i,{style:{width:"100px"}},{default:l(()=>[...e[33]||(e[33]=[d("BOM ë²„ì „",-1)])]),_:1}),t(i,{style:{width:"120px"}},{default:l(()=>[...e[34]||(e[34]=[d("ìœ íš¨ ì‹œìž‘ì¼ìž",-1)])]),_:1}),t(i,{style:{width:"120px"}},{default:l(()=>[...e[35]||(e[35]=[d("ìœ íš¨ ì¢…ë£Œì¼ìž",-1)])]),_:1}),t(i,{style:{width:"80px"}},{default:l(()=>[...e[36]||(e[36]=[d("ìƒíƒœ",-1)])]),_:1}),t(i,{style:{width:"100px"}},{default:l(()=>[...e[37]||(e[37]=[d("ë¹„ê³ ",-1)])]),_:1})]),_:1})]),_:1}),t(J,null,{default:l(()=>[(g(!0),L(I,null,$(O.value,(a,w)=>(g(),R(U,{key:w,class:Q({"selected-row":M.value===w}),onClick:s=>de(a,w)},{default:l(()=>[t(r,{class:"text-center",style:{width:"30px"}},{default:l(()=>[t(F,{modelValue:a.selected,"onUpdate:modelValue":s=>a.selected=s,onClick:e[3]||(e[3]=p(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{class:"text-end",style:{width:"40px"}},{default:l(()=>[d(W(w+1),1)]),_:2},1024),t(r,{class:"text-end text-primary",style:{width:"120px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.bom_id=s,class:"cell-input",readonly:"",onClick:e[4]||(e[4]=p(()=>{},["stop"]))},null,8,Me),[[m,a.bom_id]])]),_:2},1024),t(r,{class:"text-start",style:{width:"120px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.prdt_nm=s,class:"cell-input",readonly:"",onClick:e[5]||(e[5]=p(()=>{},["stop"]))},null,8,he),[[m,a.prdt_nm]])]),_:2},1024),t(r,{class:"text-start",style:{width:"120px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.opt_nm=s,class:"cell-input",readonly:"",onClick:e[6]||(e[6]=p(()=>{},["stop"]))},null,8,Ue),[[m,a.opt_nm]])]),_:2},1024),t(r,{class:"text-start",style:{width:"100px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.bom_ver=s,class:"cell-input",onClick:e[7]||(e[7]=p(()=>{},["stop"]))},null,8,Be),[[m,a.bom_ver]])]),_:2},1024),t(r,{class:"text-start",style:{width:"120px"}},{default:l(()=>[f(n("input",{type:"Date","onUpdate:modelValue":s=>a.valid_fr_dt=s,class:"cell-input",onClick:e[8]||(e[8]=p(()=>{},["stop"]))},null,8,Ne),[[m,a.valid_fr_dt]])]),_:2},1024),t(r,{class:"text-start",style:{width:"120px"}},{default:l(()=>[f(n("input",{type:"Date","onUpdate:modelValue":s=>a.valid_to_dt=s,class:"cell-input",onClick:e[9]||(e[9]=p(()=>{},["stop"]))},null,8,Oe),[[m,a.valid_to_dt]])]),_:2},1024),t(r,{class:"text-start",style:{width:"80px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.st=s,class:"cell-input",onClick:e[10]||(e[10]=p(()=>{},["stop"]))},null,8,De),[[m,a.st]])]),_:2},1024),t(r,{class:"text-start"},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.rm=s,class:"cell-input",onClick:e[11]||(e[11]=p(()=>{},["stop"]))},null,8,Re),[[m,a.rm]])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),(g(!0),L(I,null,$(le.value,a=>(g(),R(U,{key:"empty-"+a,class:"empty-row"},{default:l(()=>[t(r,{colspan:"8"},{default:l(()=>[...e[38]||(e[38]=[d("Â ",-1)])]),_:1})]),_:1}))),128))]),_:1})]),_:1})])])]),_:1}),t(V,{md:6,class:"d-flex flex-column overflow-hidden gap-2"},{default:l(()=>[n("div",Se,[t(u,{color:"secondary",size:"sm",onClick:Z},{default:l(()=>[...e[39]||(e[39]=[d("ìžìž¬ ì¡°íšŒ",-1)])]),_:1}),t(Ce,{visible:S.value,onClose:e[12]||(e[12]=a=>S.value=!1),onSelect:ee},null,8,["visible"]),t(be,{visible:T.value,onClose:e[13]||(e[13]=a=>T.value=!1),onSelect:te},null,8,["visible"]),t(u,{color:"secondary",size:"sm",onClick:pe},{default:l(()=>[...e[40]||(e[40]=[d("ì €ìž¥",-1)])]),_:1}),t(u,{color:"danger",size:"sm",onClick:_e},{default:l(()=>[...e[41]||(e[41]=[d("ì„ íƒì‚­ì œ",-1)])]),_:1})]),n("div",Te,[n("div",ze,[t(K,{bordered:"",hover:"",class:"data-table"},{default:l(()=>[t(G,null,{default:l(()=>[t(U,null,{default:l(()=>[t(i,{style:{width:"30px"}},{default:l(()=>[t(F,{checked:P.value,onChange:se},null,8,["checked"])]),_:1}),t(i,{style:{width:"40px"}},{default:l(()=>[...e[42]||(e[42]=[d("No",-1)])]),_:1}),t(i,{style:{width:"120px"}},{default:l(()=>[...e[43]||(e[43]=[d("ìžìž¬ëª…",-1)])]),_:1}),t(i,{style:{width:"100px"}},{default:l(()=>[...e[44]||(e[44]=[d("ê·œê²©",-1)])]),_:1}),t(i,{style:{width:"80px"}},{default:l(()=>[...e[45]||(e[45]=[d("ë‹¨ìœ„",-1)])]),_:1}),t(i,{style:{width:"100px"}},{default:l(()=>[...e[46]||(e[46]=[d("BOM ìˆ˜ëŸ‰",-1)])]),_:1}),t(i,{style:{width:"100px"}},{default:l(()=>[...e[47]||(e[47]=[d("ë¹„ê³ ",-1)])]),_:1})]),_:1})]),_:1}),t(J,null,{default:l(()=>[(g(!0),L(I,null,$(D.value,(a,w)=>(g(),R(U,{key:w,class:Q({"selected-row":h.value===w}),onClick:s=>ne(a,w)},{default:l(()=>[t(r,{class:"text-center",style:{width:"30px"}},{default:l(()=>[t(F,{modelValue:a.selected,"onUpdate:modelValue":s=>a.selected=s,onClick:e[14]||(e[14]=p(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{class:"text-end",style:{width:"40px"}},{default:l(()=>[d(W(w+1),1)]),_:2},1024),t(r,{class:"text-start",style:{width:"120px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.rsc_nm=s,class:"cell-input",onClick:e[15]||(e[15]=p(()=>{},["stop"]))},null,8,Fe),[[m,a.rsc_nm]])]),_:2},1024),t(r,{class:"text-start",style:{width:"100px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.spec_id=s,class:"cell-input",onClick:e[16]||(e[16]=p(()=>{},["stop"]))},null,8,Le),[[m,a.spec_id]])]),_:2},1024),t(r,{class:"text-start",style:{width:"80px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.unit_id=s,class:"cell-input",onClick:e[17]||(e[17]=p(()=>{},["stop"]))},null,8,$e),[[m,a.unit_id]])]),_:2},1024),t(r,{class:"text-end",style:{width:"100px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.rec_qy=s,class:"cell-input",onClick:e[18]||(e[18]=p(()=>{},["stop"]))},null,8,Ie),[[m,a.rec_qy]])]),_:2},1024),t(r,{class:"text-start",style:{width:"100px"}},{default:l(()=>[f(n("input",{"onUpdate:modelValue":s=>a.rm=s,class:"cell-input",onClick:e[19]||(e[19]=p(()=>{},["stop"]))},null,8,qe),[[m,a.rm]])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),(g(!0),L(I,null,$(oe.value,a=>(g(),R(U,{key:"empty-right-"+a,class:"empty-row"},{default:l(()=>[t(r,{colspan:"5"},{default:l(()=>[...e[48]||(e[48]=[d("Â ",-1)])]),_:1})]),_:1}))),128))]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})}}},Je=me(Ae,[["__scopeId","data-v-37455fa0"]]);export{Je as default};
