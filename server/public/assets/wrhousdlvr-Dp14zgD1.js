import{i as Ne,r as N,s as Je,e as ne,c as ee,a as S,w as c,d as r,g as v,f as t,b as Q,x as te,F as ce,h as _e,t as p,m as A,_ as De,y as Se,z as ve,o as $e,j as ue,H as Ee,v as he,B as fe,p as ae,k as ye,q as xe,u,L as Z,M as ke,N as re,O as D,P as Me,Q as Oe,K as I,R as Ce,S as Ye,E as Ie,U as me,C as Ge}from"./index-TO8iFplr.js";const Xe={class:"d-flex gap-2 mb-3"},Ze={class:"left-controls d-flex gap-2 align-items-center"},et={class:"left-controls d-flex gap-2 align-items-center"},tt={class:"left-controls d-flex gap-2 align-items-center"},lt={class:"left-controls d-flex gap-2 align-items-center"},st={style:{"max-height":"480px",overflow:"auto"}},ot={class:"table table-sm table-hover mb-0"},nt=["onDblclick"],at={key:0},it={__name:"wrhsdlvrModal",props:{visible:Boolean},emits:["close","select"],setup(ie,{emit:le}){const O=le;Ne();const g=N(""),m=N(""),B=N(""),C=N(""),x=Je([]),L=()=>{Y(),O("close")},Y=()=>{console.log("[rscOrdrModal] 검색 조건 초기화"),g.value="",m.value="",B.value="",C.value="",x.value=[]},$=async()=>{try{const V={rsc_ordr_nm:g.value||null,rcvpay_ty:m.value||null,emp_nm:B.value||null,reg_dt:C.value||null,emp_id:"EMP005"},U=(await A.get("/api/wrhsdlvr/search",{params:V}))?.data;x.value=Array.isArray(U)?U:[]}catch(V){console.error("[wrhsdlvrModal] search error",V),x.value=[]}},G=async V=>{try{const k=await A.get(`/api/wrhsdlvr/${V.wrhsdlvr_mas_id}`),{master:U,details:F}=k.data||{};O("select",{master:U,details:F}),L()}catch(k){console.error("[wrhsdlvrModal] select error:",k),O("select",{master:V,details:mappedDetails}),L()}};return(V,k)=>{const U=ne("CModalTitle"),F=ne("CModalHeader"),z=ne("CFormInput"),X=ne("CModalBody"),j=ne("CButton"),W=ne("CModalFooter"),q=ne("CModal");return S(),ee(q,{visible:ie.visible,onClose:L,size:"xl"},{default:c(()=>[r(F,null,{default:c(()=>[r(U,null,{default:c(()=>[...k[4]||(k[4]=[v("자재 발주서 조회",-1)])]),_:1})]),_:1}),r(X,null,{default:c(()=>[t("div",Xe,[t("div",Ze,[k[5]||(k[5]=t("label",{class:"search-label"},"수불 명",-1)),r(z,{modelValue:g.value,"onUpdate:modelValue":k[0]||(k[0]=i=>g.value=i),style:{width:"140px"}},null,8,["modelValue"])]),t("div",et,[k[6]||(k[6]=t("label",{class:"search-label"},"수불 유형",-1)),r(z,{modelValue:m.value,"onUpdate:modelValue":k[1]||(k[1]=i=>m.value=i),style:{width:"100px"},placeholder:"IN/OUT"},null,8,["modelValue"])]),t("div",tt,[k[7]||(k[7]=t("label",{class:"search-label"},"담당자 명",-1)),r(z,{modelValue:B.value,"onUpdate:modelValue":k[2]||(k[2]=i=>B.value=i),style:{width:"100px"}},null,8,["modelValue"])]),t("div",lt,[k[8]||(k[8]=t("label",{class:"search-label"},"수불 일자",-1)),r(z,{type:"date",modelValue:C.value,"onUpdate:modelValue":k[3]||(k[3]=i=>C.value=i),style:{width:"120px"}},null,8,["modelValue"])]),t("div",{class:"ms-auto d-flex gap-2"},[t("button",{class:"btn btn-secondary",onClick:$},"검색"),t("button",{class:"btn btn-secondary",onClick:Y},"초기화")])]),t("div",st,[t("table",ot,[k[10]||(k[10]=t("thead",null,[t("tr",null,[t("th",null,"수불 ID"),t("th",null,"수불 명"),t("th",null,"수불 유형"),t("th",null,"담당자명"),t("th",null,"등록일"),t("th",null,"품목 명"),t("th",null,"옵션 명"),t("th",null,"수량")])],-1)),t("tbody",null,[(S(!0),Q(ce,null,_e(x.value,(i,w)=>(S(),Q("tr",{key:i.wrhsdlvr_mas_id||w,onDblclick:K=>G(i)},[t("td",null,p(i.wrhsdlvr_mas_id),1),t("td",null,p(i.rcvpay_nm),1),t("td",null,p(i.rcvpay_ty),1),t("td",null,p(i.emp_nm),1),t("td",null,p(i.rcvpay_dt),1),t("td",null,p(i.prdt_nm||"-"),1),t("td",null,p(i.opt_nm||"-"),1),t("td",null,p(i.all_rcvpay_qy??"-"),1)],40,nt))),128)),x.value.length===0?(S(),Q("tr",at,[...k[9]||(k[9]=[t("td",{colspan:"5",class:"text-center text-muted"},"검색 결과 없음",-1)])])):te("",!0)])])])]),_:1}),r(W,null,{default:c(()=>[r(j,{color:"secondary",onClick:L},{default:c(()=>[...k[11]||(k[11]=[v("닫기",-1)])]),_:1})]),_:1})]),_:1},8,["visible"])}}},dt={class:"modal-body"},rt={class:"search-area"},ut={class:"row g-3"},ct={class:"col-md-3"},_t={class:"col-md-3"},pt={class:"col-md-3"},yt={class:"table-area mt-3"},mt={class:"table-responsive",style:{"max-height":"400px","overflow-y":"auto"}},vt={class:"table table-sm table-hover"},ht={class:"table-light"},ft={style:{width:"50px"}},gt=["checked"],wt=["onClick"],bt=["checked","onChange"],qt={class:"text-end"},xt={class:"text-end"},$t={class:"text-end"},kt={key:0},Mt={class:"modal-footer"},Ot=["disabled"],Ct={__name:"inspectionModal",props:{isOpen:{type:Boolean,default:!1}},emits:["close","select"],setup(ie,{emit:le}){const O=le,g=N([]),m=N([]),B=N(null),C=N(""),x=Se({item_code:"",item_name:"",insp_type:"finishedQuality"}),L=ve(()=>g.value.length>0&&g.value.every(q=>m.value.some(i=>i.insp_no===q.insp_no&&i.item_code===q.item_code&&i.opt_code===q.opt_code))),Y=async()=>{try{const q={item_code:x.item_code?.trim()||"",item_name:x.item_name?.trim()||"",insp_status:"완료"};console.log("[inspectionModal] 전송 파라미터:",q),console.log("[inspectionModal] 검사서 종류:",x.insp_type);let i="/warehouse/inspections/list";switch(q.insp_type=x.insp_type,x.insp_type){case"materialQuality":i="/warehouse/rscQltyInsp/list";break;case"semiQuality":i="/warehouse/semiPrdtQltyInsp/list";break;case"finishedQuality":i="/warehouse/endPrdtQltyInsp/list";break;default:i="/warehouse/endPrdtQltyInsp/list";break}console.log("[inspectionModal] 호출 API:",i);const w=await A.get(`/api${i}`,{params:q});console.log("[inspectionModal] API 응답:",w),console.log("[inspectionModal] 응답 데이터:",w.data),console.log("[inspectionModal] 응답 건수:",w.data?.length),w.data?.length>100&&console.warn("[inspectionModal] 조회 결과가 100건을 초과합니다!"),x.insp_type==="semiQuality"?g.value=(w.data||[]).filter(K=>!K.opt_code):g.value=w.data||[],z()}catch(q){console.error("[inspectionModal] 검사서 조회 실패:",q),console.error("[inspectionModal] 에러 상세:",{message:q.message,status:q.response?.status,statusText:q.response?.statusText,data:q.response?.data}),alert(`검사서 목록 조회 중 오류가 발생했습니다: ${q.message}`),g.value=[]}},$=()=>{x.item_code="",x.item_name="",x.insp_type="finishedQuality",z()},G=q=>{k(q),V(q)},V=q=>{B.value={...q},C.value=q.insp_no,console.log("[inspectionModal] 단일 검사서 선택:",B.value)},k=q=>{const i=m.value.findIndex(w=>w.insp_no===q.insp_no&&w.item_code===q.item_code&&w.opt_code===q.opt_code);i>-1?m.value.splice(i,1):m.value.push({...q,insp_type:x.insp_type}),console.log("[inspectionModal] 선택된 검사서들:",m.value)},U=q=>{q.target.checked?m.value=g.value.map(i=>({...i,insp_type:x.insp_type})):m.value=[]},F=q=>m.value.some(i=>i.insp_no===q.insp_no&&i.item_code===q.item_code&&i.opt_code===q.opt_code),z=()=>{m.value=[],B.value=null,C.value=""},X=q=>{if(!q)return"";try{return new Date(q).toISOString().split("T")[0]}catch{return q}},j=()=>{if(m.value.length===0){alert("검사서를 선택해주세요.");return}console.log("[inspectionModal] 최종 선택된 검사서들:",m.value),O("select",m.value),W()},W=()=>{$(),g.value=[],m.value=[],O("close")};return $e(()=>{console.log("[inspectionModal] 컴포넌트 마운트됨")}),(q,i)=>ie.isOpen?(S(),Q("div",{key:0,class:"modal-backdrop",onClick:W},[t("div",{class:"modal-container",onClick:i[5]||(i[5]=ye(()=>{},["stop"]))},[t("div",{class:"modal-header"},[i[6]||(i[6]=t("h5",null,"공정검색",-1)),t("button",{type:"button",class:"btn-close",onClick:W})]),t("div",dt,[t("div",rt,[t("div",ut,[t("div",ct,[i[8]||(i[8]=t("label",{class:"form-label"},"입고서 종류",-1)),ue(t("select",{"onUpdate:modelValue":i[0]||(i[0]=w=>x.insp_type=w),class:"form-select"},[...i[7]||(i[7]=[t("option",{value:""},"전체",-1),t("option",{value:"materialQuality"},"자재 품질 검사",-1),t("option",{value:"semiQuality"},"반제품 품질 검사",-1),t("option",{value:"finishedQuality"},"완제품 품질 검사",-1)])],512),[[Ee,x.insp_type]])]),t("div",_t,[i[9]||(i[9]=t("label",{class:"form-label"},"품목코드",-1)),ue(t("input",{"onUpdate:modelValue":i[1]||(i[1]=w=>x.item_code=w),type:"text",class:"form-control",placeholder:"품목코드 입력",onKeyup:fe(Y,["enter"])},null,544),[[he,x.item_code]])]),t("div",pt,[i[10]||(i[10]=t("label",{class:"form-label"},"품목명",-1)),ue(t("input",{"onUpdate:modelValue":i[2]||(i[2]=w=>x.item_name=w),type:"text",class:"form-control",placeholder:"품목명 입력",onKeyup:fe(Y,["enter"])},null,544),[[he,x.item_name]])]),t("div",{class:"col-md-3 d-flex align-items-end"},[t("button",{type:"button",class:"btn btn-secondary me-2",onClick:Y},"조회"),t("button",{type:"button",class:"btn btn-secondary",onClick:$},"초기화")])])]),t("div",yt,[t("div",mt,[t("table",vt,[t("thead",ht,[t("tr",null,[t("th",ft,[t("input",{type:"checkbox",checked:L.value,onChange:i[3]||(i[3]=w=>U(w)),class:"form-check-input"},null,40,gt)]),i[11]||(i[11]=t("th",{style:{width:"120px"}},"검사서 코드",-1)),i[12]||(i[12]=t("th",{style:{width:"100px"}},"품목 코드",-1)),i[13]||(i[13]=t("th",{style:{width:"150px"}},"품목 명",-1)),i[14]||(i[14]=t("th",{style:{width:"100px"}},"옵션 코드",-1)),i[15]||(i[15]=t("th",{style:{width:"150px"}},"옵션 명",-1)),i[16]||(i[16]=t("th",{style:{width:"80px"}},"총 수량",-1)),i[17]||(i[17]=t("th",{style:{width:"80px"}},"합격 수량",-1)),i[18]||(i[18]=t("th",{style:{width:"80px"}},"불합격 수량",-1)),i[19]||(i[19]=t("th",{style:{width:"80px"}},"검사 상태",-1)),i[20]||(i[20]=t("th",{style:{width:"100px"}},"검사 일자",-1)),i[21]||(i[21]=t("th",{style:{width:"100px"}},"검사자",-1))])]),t("tbody",null,[(S(!0),Q(ce,null,_e(g.value,w=>(S(),Q("tr",{key:w.insp_no,class:ae(["cursor-pointer",{"table-active":m.value.some(K=>K.insp_no===w.insp_no&&K.item_code===w.item_code&&K.opt_code===w.opt_code)}]),onClick:K=>G(w)},[t("td",{onClick:i[4]||(i[4]=ye(()=>{},["stop"]))},[t("input",{type:"checkbox",checked:F(w),onChange:K=>k(w),class:"form-check-input"},null,40,bt)]),t("td",null,p(w.insp_no),1),t("td",null,p(w.item_code),1),t("td",null,p(w.item_name),1),t("td",null,p(w.opt_code||"-"),1),t("td",null,p(w.opt_name||"-"),1),t("td",qt,p(Number(w.insp_qty||0).toLocaleString()),1),t("td",xt,p(Number(w.pass_qty||0).toLocaleString()),1),t("td",$t,p(Number(w.fail_qty||0).toLocaleString()),1),t("td",null,[t("span",{class:ae({"badge bg-success":w.insp_status==="완료","badge bg-warning":w.insp_status==="대기","badge bg-secondary":!w.insp_status})},p(w.insp_status||"미정"),3)]),t("td",null,p(w.insp_date?X(w.insp_date):""),1),t("td",null,p(w.insp_emp_name),1)],10,wt))),128)),!g.value||g.value.length===0?(S(),Q("tr",kt,[...i[22]||(i[22]=[t("td",{colspan:"11",class:"text-center text-muted py-4"},"검색 결과가 없습니다.",-1)])])):te("",!0)])])])])]),t("div",Mt,[t("button",{type:"button",class:"btn btn-secondary",onClick:j,disabled:m.value.length===0}," 선택 ("+p(m.value.length)+"건) ",9,Ot),t("button",{type:"button",class:"btn btn-secondary",onClick:W},"취소")])])])):te("",!0)}},It=De(Ct,[["__scopeId","data-v-9099e23e"]]),Nt={class:"modal-body"},Dt={class:"search-area"},St={class:"row g-3"},Et={class:"col-md-3"},Tt={class:"col-md-3"},Rt={class:"col-md-3"},At={key:0,class:"table-area mt-3"},Qt={class:"table-responsive",style:{"max-height":"400px","overflow-y":"auto"}},Pt={class:"table table-sm table-hover"},Bt={class:"table-light"},Vt={style:{width:"50px"}},Lt=["checked"],Wt=["onClick"],Ut=["checked","onChange"],zt={class:"text-end"},Kt={key:0},Ft={key:1,class:"table-area mt-3"},jt={class:"table-responsive",style:{"max-height":"400px","overflow-y":"auto"}},Ht={class:"table table-sm table-hover"},Jt={class:"table-light"},Yt={style:{width:"50px"}},Gt=["checked"],Xt=["onClick"],Zt=["checked","onChange"],el={class:"text-end"},tl={key:0},ll={class:"modal-footer"},sl=["disabled"],ol={__name:"deliveryModal",props:{isOpen:{type:Boolean,default:!1}},emits:["close","select"],setup(ie,{emit:le}){const O=le,g=N([]),m=N([]),B=N(null),C=N(""),x=N([]),L=N([]),Y=N(null),$=Se({item_code:"",item_name:"",insp_type:"deliveryDetail"}),G=ve(()=>$.insp_type==="materialWithdrawal"?x.value.length>0&&x.value.every(b=>{const a=b.withdrawal_id;return m.value.some(y=>y.insp_no===a)}):g.value.length>0&&g.value.every(b=>m.value.some(a=>a.insp_no===b.insp_no))),V=async()=>{try{const b={item_code:$.item_code?.trim()||"",item_name:$.item_name?.trim()||"",insp_status:"완료"};console.log("[deliveryModal] 전송 파라미터:",b),console.log("[deliveryModal] 검사서 종류:",$.insp_type),$.insp_type==="materialWithdrawal"?await k(b):await U(b)}catch(b){console.error("[deliveryModal] 조회 실패:",b),alert("데이터 조회에 실패했습니다.")}},k=async b=>{const a={product_code:b.item_code||"",product_name:b.item_name||""};console.log("[deliveryModal] 생산지시 조회 API 호출:",a);const y=await A.get("/api/production/orders/details",{params:a});console.log("[deliveryModal] 생산지시 응답:",y.data);const P=[],se=new Set;for(const H of y.data||[]){const oe=`${H.withdrawal_id}_${H.item_code}_${H.opt_code||""}`;se.has(oe)||(se.add(oe),P.push(H))}x.value=P,L.value=[],Y.value=null,i()},U=async b=>{let a="/delivery/products/list";switch(b.insp_type=$.insp_type,$.insp_type){case"deliveryDetail":a="/delivery/products/list";break;default:a="/delivery/products/list";break}console.log("[deliveryModal] 호출 API:",a);const y=await A.get(`/api${a}`,{params:b});console.log("[deliveryModal] API 응답:",y),console.log("[deliveryModal] 응답 데이터:",y.data),console.log("[deliveryModal] 응답 건수:",y.data?.length),console.log("[deliveryModal] 첫 번째 데이터 상세:",JSON.stringify(y.data?.[0],null,2)),y.data?.length>100&&console.warn("[deliveryModal] 조회 결과가 100건을 초과합니다!");const P=[],se=new Set;for(const H of y.data||[]){const oe=`${H.insp_no}_${H.item_code}_${H.opt_code||""}`;se.has(oe)||(se.add(oe),P.push(H))}g.value=P,i()},F=()=>{$.item_code="",$.item_name="",$.insp_type="deliveryDetail",i()},z=b=>{j(b),X(b)},X=b=>{B.value={...b},C.value=b.insp_no,console.log("[deliveryModal] 단일 검사서 선택:",B.value)},j=b=>{let a;$.insp_type==="materialWithdrawal"?a=b.withdrawal_id:a=b.insp_no;const y=m.value.findIndex(P=>P.insp_no===a);y>-1?m.value.splice(y,1):$.insp_type==="materialWithdrawal"?m.value.push({insp_no:a,insp_type:$.insp_type,item_type:b.item_type,item_code:b.item_code,item_name:b.item_name,opt_code:b.opt_code,opt_name:b.opt_name,item_spec:b.item_spec,item_unit:b.item_unit,required_qty:b.required_qty,emp_name:b.emp_name}):m.value.push({...b,insp_no:a,insp_type:$.insp_type}),console.log("[deliveryModal] 선택된 검사서들:",m.value)},W=b=>{b.target.checked?$.insp_type==="materialWithdrawal"?m.value=x.value.map(a=>({insp_no:a.withdrawal_id,insp_type:$.insp_type,item_type:a.item_type,item_code:a.item_code,item_name:a.item_name,opt_code:a.opt_code,opt_name:a.opt_name,item_spec:a.item_spec,item_unit:a.item_unit,required_qty:a.required_qty,emp_name:a.emp_name})):m.value=g.value.map(a=>({...a,insp_type:$.insp_type})):m.value=[]},q=b=>{let a;return $.insp_type==="materialWithdrawal"?a=b.withdrawal_id:a=b.insp_no,m.value.some(y=>y.insp_no===a)},i=()=>{m.value=[],B.value=null,C.value=""},w=b=>{if(!b)return"";try{return new Date(b).toISOString().split("T")[0]}catch{return b}},K=()=>{if(m.value.length===0){alert("검사서를 선택해주세요.");return}console.log("[deliveryModal] 최종 선택된 검사서들:",m.value),O("select",m.value),de()},de=()=>{F(),g.value=[],m.value=[],O("close")};return $e(()=>{console.log("[deliveryModal] 컴포넌트 마운트됨")}),(b,a)=>ie.isOpen?(S(),Q("div",{key:0,class:"modal-backdrop",onClick:de},[t("div",{class:"modal-container",onClick:a[7]||(a[7]=ye(()=>{},["stop"]))},[t("div",{class:"modal-header"},[a[8]||(a[8]=t("h5",null,"출고서 목록",-1)),t("button",{type:"button",class:"btn-close",onClick:de})]),t("div",Nt,[t("div",Dt,[t("div",St,[t("div",Et,[a[10]||(a[10]=t("label",{class:"form-label"},"출고서 종류",-1)),ue(t("select",{"onUpdate:modelValue":a[0]||(a[0]=y=>$.insp_type=y),class:"form-select"},[...a[9]||(a[9]=[t("option",{value:""},"전체",-1),t("option",{value:"materialWithdrawal"},"자재 불출",-1),t("option",{value:"deliveryDetail"},"완제품 납품",-1)])],512),[[Ee,$.insp_type]])]),t("div",Tt,[a[11]||(a[11]=t("label",{class:"form-label"},"품목코드",-1)),ue(t("input",{"onUpdate:modelValue":a[1]||(a[1]=y=>$.item_code=y),type:"text",class:"form-control",placeholder:"품목코드 입력",onKeyup:fe(V,["enter"])},null,544),[[he,$.item_code]])]),t("div",Rt,[a[12]||(a[12]=t("label",{class:"form-label"},"품목 명",-1)),ue(t("input",{"onUpdate:modelValue":a[2]||(a[2]=y=>$.item_name=y),type:"text",class:"form-control",placeholder:"품목 명 입력",onKeyup:fe(V,["enter"])},null,544),[[he,$.item_name]])]),t("div",{class:"col-md-3 d-flex align-items-end"},[t("button",{type:"button",class:"btn btn-secondary me-2",onClick:V},"조회"),t("button",{type:"button",class:"btn btn-secondary",onClick:F},"초기화")])])]),$.insp_type==="materialWithdrawal"?(S(),Q("div",At,[t("div",Qt,[t("table",Pt,[t("thead",Bt,[t("tr",null,[t("th",Vt,[t("input",{type:"checkbox",checked:G.value,onChange:a[3]||(a[3]=y=>W(y)),class:"form-check-input"},null,40,Lt)]),a[13]||(a[13]=t("th",{style:{width:"120px"}},"검사서 ID",-1)),a[14]||(a[14]=t("th",{style:{width:"80px"}},"품목 유형",-1)),a[15]||(a[15]=t("th",{style:{width:"100px"}},"품목 코드",-1)),a[16]||(a[16]=t("th",{style:{width:"150px"}},"품목 명",-1)),a[17]||(a[17]=t("th",{style:{width:"100px"}},"옵션 코드",-1)),a[18]||(a[18]=t("th",{style:{width:"150px"}},"옵션 명",-1)),a[19]||(a[19]=t("th",{style:{width:"80px"}},"규격",-1)),a[20]||(a[20]=t("th",{style:{width:"60px"}},"단위",-1)),a[21]||(a[21]=t("th",{style:{width:"80px"}},"수량",-1)),a[22]||(a[22]=t("th",{style:{width:"100px"}},"담당자 명",-1))])]),t("tbody",null,[(S(!0),Q(ce,null,_e(x.value,y=>(S(),Q("tr",{key:y.withdrawal_id,class:ae(["cursor-pointer",{"table-active":m.value.some(P=>P.insp_no===y.withdrawal_id)}]),onClick:P=>z(y)},[t("td",{onClick:a[4]||(a[4]=ye(()=>{},["stop"]))},[t("input",{type:"checkbox",checked:q(y),onChange:P=>j(y),class:"form-check-input"},null,40,Ut)]),t("td",null,p(y.withdrawal_id),1),t("td",null,p(y.item_type),1),t("td",null,p(y.item_code),1),t("td",null,p(y.item_name),1),t("td",null,p(y.opt_code||"-"),1),t("td",null,p(y.opt_name||"-"),1),t("td",null,p(y.item_spec||"-"),1),t("td",null,p(y.item_unit||"-"),1),t("td",zt,p(Number(y.required_qty||0).toLocaleString()),1),t("td",null,p(y.emp_name),1)],10,Wt))),128)),!x.value||x.value.length===0?(S(),Q("tr",Kt,[...a[23]||(a[23]=[t("td",{colspan:"11",class:"text-center text-muted py-4"},"검색 결과가 없습니다.",-1)])])):te("",!0)])])])])):(S(),Q("div",Ft,[t("div",jt,[t("table",Ht,[t("thead",Jt,[t("tr",null,[t("th",Yt,[t("input",{type:"checkbox",checked:G.value,onChange:a[5]||(a[5]=y=>W(y)),class:"form-check-input"},null,40,Gt)]),a[24]||(a[24]=t("th",{style:{width:"120px"}},"출고서 코드",-1)),a[25]||(a[25]=t("th",{style:{width:"100px"}},"품목 코드",-1)),a[26]||(a[26]=t("th",{style:{width:"150px"}},"품목 명",-1)),a[27]||(a[27]=t("th",{style:{width:"100px"}},"옵션 코드",-1)),a[28]||(a[28]=t("th",{style:{width:"150px"}},"옵션 명",-1)),a[29]||(a[29]=t("th",{style:{width:"80px"}},"출고 예정 수량",-1)),a[30]||(a[30]=t("th",{style:{width:"80px"}},"출고 상태",-1)),a[31]||(a[31]=t("th",{style:{width:"100px"}},"검사 일자",-1)),a[32]||(a[32]=t("th",{style:{width:"100px"}},"검사자",-1))])]),t("tbody",null,[(S(!0),Q(ce,null,_e(g.value,y=>(S(),Q("tr",{key:y.insp_no,class:ae(["cursor-pointer",{"table-active":m.value.some(P=>P.insp_no===y.insp_no)}]),onClick:P=>z(y)},[t("td",{onClick:a[6]||(a[6]=ye(()=>{},["stop"]))},[t("input",{type:"checkbox",checked:q(y),onChange:P=>j(y),class:"form-check-input"},null,40,Zt)]),t("td",null,p(y.insp_no),1),t("td",null,p(y.item_code),1),t("td",null,p(y.item_name),1),t("td",null,p(y.opt_code||"-"),1),t("td",null,p(y.opt_name||"-"),1),t("td",el,p(Number(y.pass_qty||0).toLocaleString()),1),t("td",null,[t("span",{class:ae({"badge bg-success":y.insp_status==="완료","badge bg-warning":y.insp_status==="대기","badge bg-secondary":!y.insp_status})},p(y.insp_status||"미정"),3)]),t("td",null,p(y.insp_date?w(y.insp_date):""),1),t("td",null,p(y.insp_emp_name),1)],10,Xt))),128)),!g.value||g.value.length===0?(S(),Q("tr",tl,[...a[33]||(a[33]=[t("td",{colspan:"9",class:"text-center text-muted py-4"},"검색 결과가 없습니다.",-1)])])):te("",!0)])])])]))]),t("div",ll,[t("button",{type:"button",class:"btn btn-secondary",onClick:K,disabled:m.value.length===0}," 선택 ("+p(m.value.length)+"건) ",9,sl),t("button",{type:"button",class:"btn btn-secondary",onClick:de},"취소")])])])):te("",!0)}},nl=De(ol,[["__scopeId","data-v-46879e09"]]),al={class:"d-flex align-items-center mb-3 gap-2"},il={class:"ms-auto d-flex gap-2"},dl={class:"card mb-1",style:{height:"35vh"}},rl={class:"card-body p-0",style:{overflow:"auto",height:"calc(35vh - 60px)"}},ul={class:"card",style:{height:"35vh"}},cl={class:"card-header d-flex justify-content-between align-items-center py-2"},_l={class:"text-muted small"},pl={class:"card-body p-0",style:{overflow:"auto",height:"calc(35vh - 60px)"}},ml={__name:"wrhousdlvr",setup(ie){const le=Ne(),O=N("in"),g=N([]),m=N([]),B=async()=>{if(O.value==="out")for(const e of g.value)if(e.id&&e.id.includes("_PROD_ORDER_")){const l=(m.value||[]).filter(s=>s.inspect_id===e.inspect_id);if(console.log("[가용수량계산][완제품]",e.name,e.code,e.opt_code,"BOM자재목록:",l),l.length===0)e.available_qty=0;else{const s={};for(const n of l){const h=`${n.code||n.item_code||""}_${n.opt_code||""}`;s[h]||(s[h]={stock:0,bomQty:Number(n.bom_qty)||0}),s[h].stock+=Number(n.stock_qty)||0}let _=1/0,d=0;for(const n in s){const{stock:h,bomQty:f}=s[n];if(!f||isNaN(f)||f<=0){console.warn(`[가용수량계산][${n}] BOM 소요량(bomQty)이 0 또는 NaN, 계산에서 제외`,{stock:h,bomQty:f});continue}const o=Math.floor(h/f);d++,console.log(`[가용수량계산][${n}] 합산재고:`,h,"BOM소요량:",f,"생산가능수량:",o),o<_&&(_=o)}d===0?(e.available_qty=0,console.warn("[가용수량계산] 모든 BOM 자재의 소요량이 0 또는 NaN이어서 가용수량 0 처리")):e.available_qty=isFinite(_)?_:0}(e.qty===void 0||e.qty===null||isNaN(e.qty)||Number(e.qty)===0)&&(e.qty=e.available_qty),e._init_qty===void 0&&(e._init_qty=e.qty)}else{const l={item_type:e.type==="자재"?"E1":e.type==="반제품"?"E2":"E3",item_code:e.code,item_opt_code:e.opt_code||""};try{const{data:s}=await A.get("/api/warehouse/available-qty",{params:l}),_=s?.available_qty??0;e.available_qty=_,(e.qty===void 0||e.qty===null||isNaN(e.qty)||Number(e.qty)===0)&&(e.qty=_),e._init_qty===void 0&&(e._init_qty=e.qty)}catch{e.available_qty=0,(e.qty===void 0||e.qty===null||isNaN(e.qty))&&(e.qty=0),e._init_qty===void 0&&(e._init_qty=e.qty)}}else for(const e of g.value)if(e.code)try{if(e.inspect_id){const l={inspect_id:e.inspect_id,item_type:e.type==="자재"?"E1":e.type==="반제품"?"E2":"E3"},{data:s}=await A.get("/api/warehouse/inspection-remaining-qty",{params:l});e.available_qty=s?.remaining_qty??0}else{const l={item_type:e.type==="자재"?"E1":e.type==="반제품"?"E2":"E3",item_code:e.code,item_opt_code:e.opt_code||""},{data:s}=await A.get("/api/warehouse/available-qty",{params:l});e.available_qty=s?.available_qty??0}(e.qty===void 0||e.qty===null||isNaN(e.qty)||Number(e.qty)===0)&&(e.qty=e.available_qty)}catch{e.available_qty=0,(e.qty===void 0||e.qty===null||isNaN(e.qty))&&(e.qty=0)}},C=N([]),x=N(""),L=N("");xe(()=>le.user,e=>{if(!e){x.value="",L.value="";return}x.value=e.emp_nm??e.name??"",L.value=e.emp_id??e.id??""},{immediate:!0});const Y=ve(()=>{const e={},l=g.value.filter(n=>n&&n.id!=null&&C.value&&C.value.includes(n.id));let s=[];if(Array.isArray(m.value)&&m.value.length>0){const n=l.filter(f=>f&&typeof f.id=="string"&&f.id.includes("_PROD_ORDER_")).map(f=>f&&f.inspect_id).filter(f=>f!=null);console.log("[wrhousdlvr] 체크된 생산지시 ID 목록:",n);const h=m.value.filter(f=>f&&f.inspect_id!=null&&n.includes(f.inspect_id));console.log("[wrhousdlvr] 필터링된 BOM 자재:",h.length,"건"),s.push(...h)}const _=l.filter(n=>n&&typeof n.id=="string"&&!n.id.includes("_PROD_ORDER_"));s.push(..._),console.log("[wrhousdlvr] 하단 그리드 처리할 데이터:",{체크된_행_수:l.length,전체_BOM_자재_수:(m.value||[]).length,필터링된_BOM_자재_수:Array.isArray(m.value)?m.value.filter(n=>n&&n.inspect_id!=null&&l.filter(h=>h&&typeof h.id=="string"&&h.id.includes("_PROD_ORDER_")).map(h=>h&&h.inspect_id).filter(h=>h!=null).includes(n.inspect_id)).length:0,일반_출고서_수:_.length,총_처리_행_수:s.length,처리할_데이터:s.map(n=>({id:n&&n.id,type:n&&n.type,name:n&&n.name,inspect_id:n&&n.inspect_id}))}),s.forEach(n=>{const h=`${n.code}_${n.opt_code||"NO_OPT"}_${n.type}`;e[h]?e[h].total_qty+=Math.ceil(Number(n.qty)||0):e[h]={id:n.id,lot:n.lot||"",warehouse_id:n.warehouse_id,warehouse_name:n.warehouse_name||"",location_id:n.location_id,location_name:n.location_name||"",type:n.type,code:n.code,name:n.name,opt_code:n.opt_code,opt_name:n.opt_name,spec:n.spec,unit:n.unit,total_qty:Math.ceil(Number(n.qty)||0),rcvpay_nm:`${O.value==="in"?"입고":"출고"} 처리 - ${n.name}`,master_remark:""}});const d=Object.values(e);return console.log("[wrhousdlvr] consolidatedRows 계산됨:",{통합된_품목_수:d.length,결과:d}),d}),$=N([]);xe(Y,async e=>{O.value==="out"&&e.length>0?(console.log("[wrhousdlvr] 출고 모드 - LOT 할당 시작"),await G(e)):$.value=e},{immediate:!0});const G=async e=>{try{const l=[];for(const s of e)try{console.log("[wrhousdlvr] LOT 할당 요청:",{type:s.type,code:s.code,opt_code:s.opt_code,qty:s.total_qty});const _=await P(s.type,s.code,s.opt_code||"",s.total_qty);console.log("[wrhousdlvr] LOT 할당 응답:",_),_.success&&_.allocations.length>0?(_.allocations.forEach((d,n)=>{l.push({...s,id:`${s.id}_LOT_${n}`,lot_no:d.lot_no,lot:d.lot_no,total_qty:d.allocated_qty,warehouse_id:d.warehouse_id,zone_id:d.zone_id})}),console.log("[wrhousdlvr] LOT 할당 성공:",{item:s.name,allocations:_.allocations.length,fully_allocated:_.summary.fully_allocated}),_.summary.fully_allocated||console.warn(`[wrhousdlvr] ${s.name} - 수량 부족:`,{요청:_.summary.requested_qty,할당:_.summary.allocated_qty,부족:_.summary.shortage_qty})):(l.push({...s,lot:"-"}),console.warn("[wrhousdlvr] LOT 할당 실패:",s.name))}catch(_){console.error(`[wrhousdlvr] ${s.name} LOT 할당 실패:`,_),l.push({...s,lot:"오류"})}$.value=l,console.log("[wrhousdlvr] LOT 할당 완료:",{원본_품목_수:e.length,최종_행_수:l.length,최종_데이터:l})}catch(l){console.error("[wrhousdlvr] LOT 할당 처리 실패:",l),$.value=e}},V=e=>e.lot_no||e.lot||"-",k=e=>C.value.includes(e),U=(e,l)=>{(l&&l.target?!!l.target.checked:!C.value.includes(e))?C.value.includes(e)||C.value.push(e):C.value=C.value.filter(_=>_!==e)},F=ve(()=>g.value.length===0?!1:g.value.every(e=>C.value.includes(e.id))),z=e=>{(e&&e.target?!!e.target.checked:!F.value)?C.value=g.value.map(s=>s.id):C.value=[]},X=e=>{O.value!==e&&(O.value=e,g.value=[],C.value=[],console.log(`[wrhousdlvr] 모드 변경: ${e}`))},j=N(!1),W=N(!1),q=N(!1),i=N([]),w=N([]);$e(async()=>{console.log("[wrhousdlvr] 컴포넌트 마운트됨"),await K(),await de(),await B()}),xe(g,()=>{B()});const K=async()=>{try{console.log("[wrhousdlvr] 전체 창고 목록 조회 시작");const e=await A.get("/api/warehouses/all");i.value=e.data||[],console.log("[wrhousdlvr] 창고 목록 로드:",i.value.length,"건"),console.log("[wrhousdlvr] 창고 데이터:",i.value)}catch(e){console.error("[wrhousdlvr] 창고 목록 로드 실패:",e),console.error("[wrhousdlvr] 에러 상세:",e.response?.data||e.message),i.value=[]}},de=async()=>{try{const e=await A.get("/api/locations/all");w.value=e.data||[],console.log("[wrhousdlvr] 로케이션 목록 로드:",w.value.length,"건"),console.log("[wrhousdlvr] 로케이션 데이터:",w.value)}catch(e){console.error("[wrhousdlvr] 로케이션 목록 로드 실패:",e),w.value=[]}},b=async e=>{try{console.log("[wrhousdlvr] 품목 유형별 창고 조회 시작"),console.log("[wrhousdlvr] 요청 품목 유형:",e),console.log("[wrhousdlvr] 요청 URL:","/api/warehouses/all"),console.log("[wrhousdlvr] 요청 파라미터:",{item_type:e});const l=await A.get("/api/warehouses/all",{params:{item_type:e}});console.log("[wrhousdlvr] 응답 전체:",l),console.log("[wrhousdlvr] 응답 상태:",l.status),console.log("[wrhousdlvr] 응답 데이터:",l.data);const s=l.data||[];return console.log("[wrhousdlvr] 최종 창고 배열:",s),console.log("[wrhousdlvr] 창고 개수:",s.length),s}catch(l){return console.error("[wrhousdlvr] 품목 유형별 창고 조회 실패:",l),console.error("[wrhousdlvr] 에러 상세:",l.response?.data||l.message),[]}},a=async(e,l=null)=>{try{console.log("[wrhousdlvr] 품목 유형별 로케이션 조회:",e,l);const s={item_type:e};l&&(s.warehouse_id=l);const d=(await A.get("/api/locations/all",{params:s})).data||[];return console.log("[wrhousdlvr] 품목 유형별 로케이션 결과:",d),d}catch(s){return console.error("[wrhousdlvr] 품목 유형별 로케이션 조회 실패:",s),[]}},y=()=>{console.log("[wrhousdlvr] 하단 그리드 총계 업데이트됨 (체크된 행 기준)")},P=async(e,l,s,_)=>{try{console.log("[wrhousdlvr] LOT 할당 조회 시작:",{itemType:e,itemCode:l,itemOptCode:s,quantity:_});const n={item_type:e==="자재"?"E1":e==="반제품"?"E2":"E3",item_code:l,item_opt_code:s||"",quantity:_},h=await A.get("/api/warehouse/lots/allocations",{params:n});return console.log("[wrhousdlvr] LOT 할당 조회 응답:",h.data),h.data}catch(d){return console.error("[wrhousdlvr] LOT 할당 조회 실패:",d),{success:!1,allocations:[],summary:{requested_qty:_,allocated_qty:0,fully_allocated:!1,shortage_qty:_}}}},se=(e,l)=>{console.log("[onQuantityInput] summaryRows 기준 수량 필드 체크:"),g.value.forEach(d=>{console.log(`id=${d.id}, inspect_id=${d.inspect_id}, code=${d.code}, opt_code=${d.opt_code}, origin_qty=${d.origin_qty}, pass_qty=${d.pass_qty}, available_qty=${d.available_qty}, qty=${d.qty}`)});let s=Math.round(Number(l.target.value)||0),_=!1;if(!e.wrhsdlvr_mas_id){if(O.value==="in")s>(e.available_qty||0)&&(s=e.available_qty||0,alert("요청 수량은 가용 수량을 초과할 수 없습니다."),_=!0);else if(O.value==="out"){let d=e._init_qty!==void 0?e._init_qty:0;d>0&&s>d&&(s=d,alert("요청 수량은 출고서의 최초 요청 수량을 초과할 수 없습니다."),_=!0)}}e.qty=s,_&&l&&l.target&&(l.target.value=s),e.id&&e.id.includes("_PROD_ORDER_")&&m.value&&H(e),y()},H=e=>{const l=e.inspect_id,s=Math.round(e.qty||0);console.log("[wrhousdlvr] BOM 자재 수량 업데이트:",{생산지시_ID:l,새로운_생산수량:s}),m.value&&m.value.forEach(_=>{if(_.inspect_id===l){const d=_.bom_qty||_.rec_qy||1,n=Math.ceil(d*s);console.log("[wrhousdlvr] 자재 수량 재계산:",{자재_코드:_.code,자재_명:_.name,단위_BOM_수량:d,생산_수량:s,정확한_계산값:d*s,계산된_자재_수량:n,기존_자재_수량:_.qty,계산식:`${d} × ${s} = ${d*s} → 올림 ${n}`}),_.qty=n}})},oe=e=>{e.qty&&typeof e.qty=="number"&&(e.qty=Math.round(e.qty))},ge=()=>{g.value=[],C.value=[],O.value="in",m.value=[],console.log("[wrhousdlvr] 전체 초기화 완료 (BOM 자재 포함)")},Te=()=>{console.log("[wrhousdlvr] 수불서 모달 열기"),j.value=!0},Re=()=>{console.log("[wrhousdlvr] 수불서 모달 닫기"),j.value=!1},Ae=({master:e,details:l})=>{Array.isArray(l)&&e&&l.forEach(s=>{!s.wrhsdlvr_mas_id&&e.wrhsdlvr_mas_id&&(s.wrhsdlvr_mas_id=e.wrhsdlvr_mas_id),!s.prdt_nm&&e.prdt_nm&&(s.prdt_nm=e.prdt_nm)}),g.value=Array.isArray(l)?l:[],$.value=e?[e]:[],C.value=g.value.map(s=>s.id||s.wrhsdlvr_id||s.wrhous_wrhsdlvr_id||s.wrhsdlvr_mas_id),console.log("[wrhousdlvr] 수불서 선택됨:",{master:e,details:l})},Qe=()=>{console.log("[wrhousdlvr] 검사서 조회 모달 열기"),W.value=!0},Pe=()=>{console.log("[wrhousdlvr] 검사서 조회 모달 닫기"),W.value=!1},we=e=>{switch(e){case"materialQuality":case"materialWithdrawal":return"자재";case"semiQuality":return"반제품";case"finishedQuality":case"deliveryDetail":return"완제품";default:return"자재"}},Be=async e=>{if(console.log("[wrhousdlvr] 검사서 선택됨:",e),console.log(`[wrhousdlvr] 선택된 검사서 수: ${e.length}`),e.forEach((f,o)=>{console.log(`[검사서 ${o}]`,{insp_no:f.insp_no,code:f.item_code||f.rsc_id,name:f.item_name||f.rsc_nm,available_qty:f.available_qty||0,available_qty_display:f.available_qty_display||`0 ${f.item_unit||f.rsc_unit||"EA"}`})}),!Array.isArray(e)||e.length===0){alert("선택된 검사서가 없습니다.");return}const s=e[0].insp_type;["materialQuality","semiQuality","finishedQuality"].includes(s)&&(O.value="in");const _=[];for(let f=0;f<e.length;f++){const o=e[f],E=o.item_type||we(o.insp_type),J=o.item_code||o.rsc_id,T=o.opt_code||"";let R=0;try{if(o.insp_no){const M={inspect_id:o.insp_no,item_type:E==="자재"?"E1":E==="반제품"?"E2":"E3"},{data:pe}=await A.get("/api/warehouse/inspection-remaining-qty",{params:M});R=pe?.remaining_qty??0}else{const M={item_type:E==="자재"?"E1":E==="반제품"?"E2":"E3",item_code:J,item_opt_code:T},{data:pe}=await A.get("/api/warehouse/available-qty",{params:M});R=pe?.available_qty??0}}catch{R=0}_.push({id:o.insp_no+"_"+(o.opt_code||"NO_OPT")+"_"+Date.now()+"_"+f,inspect_id:o.insp_no,type:E,code:J,name:o.item_name||o.rsc_nm,opt_code:T,opt_name:o.opt_name||"",spec:o.item_spec||o.rsc_spec||"",unit:o.item_unit||o.rsc_unit||"",qty:R,emp_nm:x.value,remark:`${O.value==="in"?"입고":"출고"} 처리`,warehouse_id:"",warehouse_name:"",location_id:"",location_name:"",available_qty:R,available_qty_display:typeof R=="number"&&R>0?`${R} ${o.item_unit||o.rsc_unit||"EA"}`:`0 ${o.item_unit||o.rsc_unit||"EA"}`})}console.log(`[wrhousdlvr] 요약 테이블에 추가할 행 수: ${_.length}`);const d=g.value.map(f=>`${f.inspect_id}_${f.code}_${f.opt_code||"NO_OPT"}`);console.log("[wrhousdlvr] 기존 요약 테이블 키들:",d);const n=_.filter(f=>{const o=`${f.inspect_id}_${f.code}_${f.opt_code||"NO_OPT"}`;return!d.includes(o)});console.log(`[wrhousdlvr] 중복 제거 후 요약 테이블 추가 행 수: ${n.length}`),g.value.push(...n);const h=n.map(f=>f.id);C.value.push(...h),await be(n),await B(),await Ge(),alert(`${n.length}건의 입고서 품목이 추가되었습니다.`)},be=async e=>{console.log("[wrhousdlvr] 창고/로케이션 정보 업데이트 시작:",e.length,"건");const l=e.map(async s=>{const _=s.type;console.log(`[wrhousdlvr] 행 ${s.id} 처리 중, 품목 유형: ${_}`);try{const d=await b(_);if(console.log("[wrhousdlvr] 사용 가능한 창고:",d),d.length>0){const n=d[0];s.warehouse_id=n.warehouse_id,s.warehouse_name=n.warehouse_name,console.log(`[wrhousdlvr] 창고 설정 완료: ${n.warehouse_name}`);const h=await a(_,n.warehouse_id);if(console.log("[wrhousdlvr] 사용 가능한 로케이션:",h),h.length>0){const f=h[0];s.location_id=f.location_id,s.location_name=f.location_name,console.log(`[wrhousdlvr] 로케이션 설정 완료: ${f.location_name}`)}}}catch(d){console.error("[wrhousdlvr] 창고/로케이션 조회 중 오류:",d)}});await Promise.all(l),console.log("[wrhousdlvr] 창고/로케이션 정보 업데이트 완료"),g.value=[...g.value]},Ve=()=>{console.log("[wrhousdlvr] 출고서 조회 모달 열기"),q.value=!0},Le=()=>{console.log("[wrhousdlvr] 출고서 조회 모달 닫기"),q.value=!1},We=async e=>{if(console.log("[wrhousdlvr] 출고서 선택됨:",e),!Array.isArray(e)||e.length===0){alert("선택된 출고서가 없습니다.");return}const s=e[0].insp_type;["materialWithdrawal","deliveryDetail"].includes(s)&&(O.value="out"),s==="materialWithdrawal"?await Ue(e):await ze(e)},Ue=async e=>{console.log("[wrhousdlvr] 자재 불출 처리 시작:",e);try{const l=e.map(o=>{console.log("[wrhousdlvr] 전체 delivery 객체:",o),console.log("[wrhousdlvr] 생산지시 수량 확인:",{insp_no:o.insp_no,pass_qty:o.pass_qty,insp_qty:o.insp_qty,rec_qy:o.rec_qy,프로퍼티_목록:Object.keys(o)});const E=o.required_qty||o.pass_qty||o.insp_qty||o.rec_qy||o.qty||o.total_qty||o.order_qty||1;return console.log("[wrhousdlvr] 최종 사용할 수량:",E),{id:o.insp_no+"_PROD_ORDER_"+(o.opt_code||"NO_OPT")+"_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),inspect_id:o.insp_no,type:o.item_type||we(o.insp_type),code:o.item_code||o.rsc_id,name:o.item_name||o.rsc_nm,opt_code:o.opt_code||"",opt_name:o.opt_name||"",spec:o.item_spec||o.rsc_spec||"",unit:o.item_unit||o.rsc_unit||"EA",qty:Math.round(E),emp_nm:x.value,remark:`생산지시 불출 - ${o.item_name}`,warehouse_id:"",warehouse_name:"",location_id:"",location_name:"",production_order_id:o.insp_no,production_item_name:o.item_name,insp_type:o.insp_type,prod_drct_deta_id:o.prod_drct_deta_id||""}});console.log("[wrhousdlvr] 변환된 생산지시 수:",l.length);const s=[];for(const o of e){console.log(`[wrhousdlvr] 생산지시 ${o.insp_no}의 BOM 자재 조회`);const J=(await A.get(`/api/production/orders/${o.insp_no}/materials`)).data||[];console.log("[wrhousdlvr] 조회된 자재 수:",J.length);const T=Math.round(o.required_qty||o.pass_qty||o.insp_qty||o.rec_qy||o.qty||o.total_qty||o.order_qty||1);J.length>0&&console.log("[wrhousdlvr] BOM 자재 상세:",J.map(M=>({자재명:M.item_name,BOM_단위수량:M.bom_qty,생산수량:T,서버계산값:M.required_qty,계산식:`${M.bom_qty} × ${T} = ${M.bom_qty*T} → 서버올림 ${M.required_qty}`,최종표시수량:Math.ceil(M.required_qty||M.remaining_qty||M.bom_qty*T)})));const R=J.map((M,pe)=>{const qe=M.bom_qty||M.rec_qy||1,He=Math.ceil(M.required_qty||M.remaining_qty||qe*T);return{id:o.insp_no+"_MATERIAL_"+M.item_code+"_"+Date.now()+"_"+pe+"_"+Math.random().toString(36).substr(2,9),inspect_id:o.insp_no,type:"자재",code:M.item_code||M.rsc_id,name:M.item_name||M.rsc_nm,opt_code:"",opt_name:"",spec:M.item_spec||M.rsc_spec||"",unit:M.item_unit||M.rsc_unit||"EA",qty:He,emp_nm:x.value,remark:`자재 불출 - ${o.item_name}`,warehouse_id:M.warehouse_id||"",warehouse_name:M.warehouse_name||"",location_id:M.location_id||"",location_name:M.location_name||"",production_order_id:o.insp_no,production_item_name:o.item_name,bom_qty:qe,rec_qy:qe,stock_qty:M.stock_qty||0}});s.push(...R)}console.log("[wrhousdlvr] 총 변환된 자재 수:",s.length);const _=g.value.map(o=>`${o.inspect_id}_${o.code}_${o.opt_code||"NO_OPT"}`),d=l.filter(o=>{const E=`${o.inspect_id}_${o.code}_${o.opt_code||"NO_OPT"}`;return!_.includes(E)});console.log("[wrhousdlvr] 중복 제거 후 추가할 생산지시 수:",d.length),g.value.push(...d),m.value||(m.value=[]);const n=m.value.map(o=>`${o.inspect_id}_${o.code}`),h=s.filter(o=>{const E=`${o.inspect_id}_${o.code}`;return!n.includes(E)});m.value.push(...h);const f=d.map(o=>o.id);C.value.push(...f),await be([...d,...h]),alert(`${d.length}건의 생산지시가 추가되었습니다.`)}catch(l){console.error("[wrhousdlvr] 자재 불출 처리 중 오류:",l),alert("생산지시 정보 처리에 실패했습니다: "+(l.response?.data?.error||l.message))}},ze=async e=>{console.log("[wrhousdlvr] 일반 출고 처리:",e);const l=e.map((n,h)=>({id:n.insp_no+"_DELIVERY_"+(n.opt_code||"NO_OPT")+"_"+Date.now()+"_"+h+"_"+Math.random().toString(36).substr(2,9),inspect_id:n.insp_no,type:n.item_type||we(n.insp_type),code:n.item_code||n.rsc_id,name:n.item_name||n.rsc_nm,opt_code:n.opt_code||"",opt_name:n.opt_name||"",spec:n.item_spec||n.rsc_spec||"",unit:n.item_unit||n.rsc_unit||"EA",qty:Math.round(n.remaining_qty||n.pass_qty||n.insp_qty||0),emp_nm:x.value,remark:`${O.value==="in"?"입고":"출고"} 처리`,warehouse_id:"",warehouse_name:"",location_id:"",location_name:"",deli_deta_id:n.insp_type==="deliveryDetail"?n.insp_no:n.deli_deta_id||n.deli_id||null})),s=g.value.map(n=>`${n.inspect_id}_${n.code}_${n.opt_code||"NO_OPT"}`),_=l.filter(n=>{const h=`${n.inspect_id}_${n.code}_${n.opt_code||"NO_OPT"}`;return!s.includes(h)});g.value.push(..._);const d=_.map(n=>n.id);C.value.push(...d),await be(_),alert(`${_.length}건의 출고서 품목이 추가되었습니다.`)},Ke=async()=>{try{if(console.log("[wrhousdlvr] 저장 함수 시작"),C.value.length===0){alert("저장할 항목을 선택해주세요.");return}console.log("[wrhousdlvr] 저장 전 선택된 데이터:",C.value.length,"건");const e=g.value.filter(d=>C.value.includes(d.id));if(O.value==="out")for(const d of e){if(d.lot&&d.lot!=="")continue;const n=$.value.find(h=>h.code===d.code&&h.opt_code===d.opt_code&&h.warehouse_id===d.warehouse_id&&h.location_id===d.location_id&&Math.round(Number(h.total_qty))===Math.round(Number(d.qty)));n&&n.lot&&(d.lot=n.lot,d.lot_no=n.lot)}if(e.length===0){alert("디테일 테이블에 저장할 데이터가 없습니다.");return}const l=e.filter((d,n)=>{const h=d.code&&d.name&&d.qty>0&&d.warehouse_id&&d.location_id;return h||console.log(`[wrhousdlvr] 유효하지 않은 행 ${n}:`,{code:d.code,name:d.name,qty:d.qty,warehouse_id:d.warehouse_id,location_id:d.location_id}),!h});if(l.length>0){alert(`품목 정보, 수량, 창고, 로케이션을 모두 입력해주세요.
유효하지 않은 행: ${l.length}개`);return}const s=e.filter(d=>!d.wrhsdlvr_mas_id),_=e.filter(d=>d.wrhsdlvr_mas_id);if(s.length>0){const d={};for(const o of s){let E="E3";o.type==="자재"?E="E1":o.type==="반제품"?E="E2":o.type==="완제품"&&(E="E3");const J=`${o.code}|${o.opt_code||"NO_OPT"}|${o.warehouse_id}|${o.location_id||""}`;if(!d[J]){let R={item_type:E,warehouse_id:o.warehouse_id,zone_id:o.location_id,qty:Number(o.qty)||0,rcvpay_ty:O.value==="in"?"S1":"S2",rcvpay_nm:`${O.value==="in"?"입고":"출고"} 처리 - ${o.name}`,emp_id:L.value,emp_name:x.value,rcvpay_dt:new Date().toISOString().split("T")[0],remark:o.master_remark||"",lot_no:o.lot||""};E==="E1"?R.rsc_id=o.code:R.prdt_id=o.code,R.prdt_opt_id=o.opt_code||"",R.item_name=o.name,R.item_spec=o.spec||"",R.item_unit=o.unit||"EA",d[J]={master:R,details:[]}}let T={item_type:E,warehouse_id:o.warehouse_id,zone_id:o.location_id,qty:Number(o.qty)||0,emp_id:L.value,emp_name:x.value,rcvpay_dt:new Date().toISOString().split("T")[0],remark:o.remark||"",lot_no:o.lot_no||o.lot||""};O.value==="in"?o.type==="자재"?T.rsc_qlty_insp_id=o.rsc_qlty_insp_id||o.inspect_id:o.type==="반제품"?T.semi_prdt_qlty_insp_id=o.semi_prdt_qlty_insp_id||o.inspect_id:o.type==="완제품"&&(T.end_prdt_qlty_insp_id=o.end_prdt_qlty_insp_id||o.inspect_id):O.value==="out"&&(o.type==="완제품"&&(o.inspect_id.startsWith("DL")||o.inspect_id.startsWith("DD"))?T.deli_deta_id=o.deli_deta_id||o.inspect_id||null:T.prod_drct_deta_id=o.prod_drct_deta_id||o.inspect_id||null),T.prdt_id=o.code,T.prdt_opt_id=o.opt_code||"",T.item_name=o.name,T.item_spec=o.spec||"",T.item_unit=o.unit||"EA",d[J].details.push(T)}const h={transactionList:Object.values(d),emp_id:L.value};console.log("[wrhousdlvr] 저장 요청 데이터(INSERT):",h);const f=await A.post("/api/warehouse/transactions",h);f.data?.success?(alert("신규 입고/출고가 완료되었습니다."),ge()):alert("신규 저장 실패: "+(f.data?.error||"알 수 없는 오류"))}if(_.length>0){const d=_.map(h=>({wrhsdlvr_mas_id:h.wrhsdlvr_mas_id,id:h.id,qty:Number(h.qty)}));console.log("[wrhousdlvr] 저장 요청 데이터(UPDATE):",d);const n=await A.post("/api/warehouse/update-qty",d);n.data?.success?(alert("수량이 정상적으로 수정되었습니다."),ge()):alert("수정 실패: "+(n.data?.error||"알 수 없는 오류"))}}catch(e){console.error("[wrhousdlvr] 저장 오류 상세:",e),alert("저장 중 오류가 발생했습니다: "+(e.response?.data?.error||e.message))}},Fe=e=>{const l=e.available_qty||0;return l<10?{color:"red",fontWeight:"bold"}:l<50?{color:"orange",fontWeight:"bold"}:{color:"green"}},je=e=>{const l=e.qty||0,s=e.available_qty||0;return O.value==="out"&&l>s?{borderColor:"red",backgroundColor:"#ffebee",color:"red",fontWeight:"bold"}:{}};return(e,l)=>(S(),ee(u(Ye),{fluid:"",class:"p-3"},{default:c(()=>[t("div",al,[t("div",null,[r(u(Z),{class:ae(O.value==="in"?"btn-secondary":"btn-outline-secondary"),size:"sm",onClick:l[0]||(l[0]=s=>X("in"))},{default:c(()=>[...l[3]||(l[3]=[v("입고",-1)])]),_:1},8,["class"]),r(u(Z),{class:ae(O.value==="out"?"btn-secondary":"btn-outline-secondary"),size:"sm",onClick:l[1]||(l[1]=s=>X("out"))},{default:c(()=>[...l[4]||(l[4]=[v("출고",-1)])]),_:1},8,["class"])]),t("div",il,[r(u(Z),{color:"secondary",size:"sm",onClick:ge},{default:c(()=>[...l[5]||(l[5]=[v("초기화",-1)])]),_:1}),r(u(Z),{color:"secondary",size:"sm",onClick:Te},{default:c(()=>[...l[6]||(l[6]=[v(" 수불서 조회 ",-1)])]),_:1}),O.value==="in"?(S(),ee(u(Z),{key:0,color:"secondary",size:"sm",onClick:Qe},{default:c(()=>[...l[7]||(l[7]=[v(" 입고서 조회 ",-1)])]),_:1})):(S(),ee(u(Z),{key:1,color:"secondary",size:"sm",onClick:Ve},{default:c(()=>[...l[8]||(l[8]=[v(" 출고서 조회 ",-1)])]),_:1})),r(u(Z),{color:"secondary",size:"sm",onClick:Ke},{default:c(()=>[...l[9]||(l[9]=[v("저장",-1)])]),_:1}),r(u(Z),{color:"danger",size:"sm"},{default:c(()=>[...l[10]||(l[10]=[v("삭제",-1)])]),_:1})])]),r(it,{visible:j.value,onClose:Re,onSelect:Ae},null,8,["visible"]),r(It,{isOpen:W.value,onClose:Pe,onSelect:Be},null,8,["isOpen"]),r(nl,{isOpen:q.value,onClose:Le,onSelect:We},null,8,["isOpen"]),t("div",dl,[l[23]||(l[23]=t("div",{class:"card-header py-2"},[t("h6",{class:"mb-0"},"입출고 상세 정보 (디테일)")],-1)),t("div",rl,[r(u(Ce),{hover:"",bordered:"",small:"",class:"mb-0"},{default:c(()=>[r(u(ke),{color:"dark"},{default:c(()=>[r(u(re),null,{default:c(()=>[r(u(D),{scope:"col",class:"text-center",style:{width:"60px"}},{default:c(()=>[r(u(Me),{checked:F.value,onChange:l[2]||(l[2]=s=>z(s))},null,8,["checked"])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[...l[11]||(l[11]=[v("수불 담당자 명",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[v(p(O.value==="in"?"입고서 ID":"출고서 ID"),1)]),_:1}),r(u(D),{class:"text-center",style:{width:"100px"}},{default:c(()=>[...l[12]||(l[12]=[v("품목 유형",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"130px"}},{default:c(()=>[...l[13]||(l[13]=[v("품목 코드",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"200px"}},{default:c(()=>[...l[14]||(l[14]=[v("품목 명",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"130px"}},{default:c(()=>[...l[15]||(l[15]=[v("옵션 코드",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"150px"}},{default:c(()=>[...l[16]||(l[16]=[v("옵션 명",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[...l[17]||(l[17]=[v("규격",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"70px"}},{default:c(()=>[...l[18]||(l[18]=[v("단위",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"110px"}},{default:c(()=>[...l[19]||(l[19]=[v("가용 수량",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"90px"}},{default:c(()=>[...l[20]||(l[20]=[v("요청 수량",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"90px"}},{default:c(()=>[...l[21]||(l[21]=[v("비고",-1)])]),_:1})]),_:1})]),_:1}),r(u(Oe),null,{default:c(()=>[(S(!0),Q(ce,null,_e(g.value,(s,_)=>(S(),ee(u(re),{key:s.id||_},{default:c(()=>[r(u(I),{class:"text-center"},{default:c(()=>[r(u(Me),{checked:k(s.id),onChange:d=>U(s.id,d)},null,8,["checked","onChange"])]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.emp_nm??""),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.inspect_id||""),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.type||""),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.code||""),1)]),_:2},1024),r(u(I),{class:"text-start"},{default:c(()=>[v(p(s.name||""),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.opt_code||"-"),1)]),_:2},1024),r(u(I),{class:"text-start"},{default:c(()=>[v(p(s.opt_name||"-"),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.spec||""),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.unit||""),1)]),_:2},1024),r(u(I),{class:"text-end",style:Ie(Fe(s))},{default:c(()=>[v(p(s.available_qty!==void 0?`${s.available_qty} ${s.unit||"EA"}`:"N/A"),1)]),_:2},1032,["style"]),r(u(I),{class:"text-end"},{default:c(()=>[r(u(me),{value:Math.round(s.qty||0),onInput:d=>se(s,d),size:"sm",type:"number",min:"0",step:"1",onBlur:d=>oe(s),style:Ie(je(s))},null,8,["value","onInput","onBlur","style"])]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[r(u(me),{modelValue:s.remark,"onUpdate:modelValue":d=>s.remark=d,size:"sm",placeholder:"디테일 비고"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),g.value.length===0?(S(),ee(u(re),{key:0},{default:c(()=>[r(u(I),{colspan:"13",class:"text-center text-muted"},{default:c(()=>[...l[22]||(l[22]=[v("데이터 없음",-1)])]),_:1})]),_:1})):te("",!0)]),_:1})]),_:1})])]),t("div",ul,[t("div",cl,[l[24]||(l[24]=t("div",{class:"fw-bold"},"입출고 상세 (선택된 품목별 총 수량)",-1)),t("div",_l," 선택된 항목: "+p(C.value.length)+" / "+p(g.value.length),1)]),t("div",pl,[r(u(Ce),{hover:"",bordered:"",small:"",class:"mb-0 align-middle"},{default:c(()=>[r(u(ke),{color:"dark"},{default:c(()=>[r(u(re),null,{default:c(()=>[r(u(D),{class:"text-center",style:{width:"70px"}},{default:c(()=>[...l[25]||(l[25]=[v("LOT",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[...l[26]||(l[26]=[v("창고",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[...l[27]||(l[27]=[v("로케이션",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"100px"}},{default:c(()=>[...l[28]||(l[28]=[v("품목 유형",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"130px"}},{default:c(()=>[...l[29]||(l[29]=[v("품목 코드",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"200px"}},{default:c(()=>[...l[30]||(l[30]=[v("품목 명",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"130px"}},{default:c(()=>[...l[31]||(l[31]=[v("옵션 코드",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"150px"}},{default:c(()=>[...l[32]||(l[32]=[v("옵션 명",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[...l[33]||(l[33]=[v("규격",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"70px"}},{default:c(()=>[...l[34]||(l[34]=[v("단위",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"70px"}},{default:c(()=>[...l[35]||(l[35]=[v("수불 명",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"90px"}},{default:c(()=>[...l[36]||(l[36]=[v("총 수량",-1)])]),_:1}),r(u(D),{class:"text-center",style:{width:"120px"}},{default:c(()=>[...l[37]||(l[37]=[v("비고",-1)])]),_:1})]),_:1})]),_:1}),r(u(Oe),null,{default:c(()=>[(S(!0),Q(ce,null,_e($.value,s=>(S(),ee(u(re),{key:s.id},{default:c(()=>[r(u(I),{class:"text-center"},{default:c(()=>[v(p(V(s)),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.warehouse_name||"-"),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.location_name||"-"),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.type),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.code),1)]),_:2},1024),r(u(I),{class:"text-start"},{default:c(()=>[v(p(s.name),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.opt_code||"-"),1)]),_:2},1024),r(u(I),{class:"text-start"},{default:c(()=>[v(p(s.opt_name||"-"),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.spec),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[v(p(s.unit),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[r(u(me),{modelValue:s.rcvpay_nm,"onUpdate:modelValue":_=>s.rcvpay_nm=_,size:"sm",placeholder:"수불 명",style:{"min-width":"120px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(u(I),{class:"text-end"},{default:c(()=>[v(p(Math.round(s.total_qty)),1)]),_:2},1024),r(u(I),{class:"text-center"},{default:c(()=>[r(u(me),{modelValue:s.master_remark,"onUpdate:modelValue":_=>s.master_remark=_,size:"sm",placeholder:"마스터 비고",style:{"min-width":"120px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),$.value.length===0?(S(),ee(u(re),{key:0},{default:c(()=>[r(u(I),{colspan:"12",class:"text-center text-muted"},{default:c(()=>[v(p(g.value.length===0?"데이터 없음":"선택된 항목이 없습니다"),1)]),_:1})]),_:1})):te("",!0)]),_:1})]),_:1})])])]),_:1}))}};export{ml as default};
