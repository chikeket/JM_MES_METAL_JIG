import{_ as P,s as Y,r as T,z as F,y as j,D as K,q as te,e as w,c as k,a as f,w as n,d as o,g as a,b as M,x as U,t as u,f as t,F as R,h as N,p as se,E as c,m as Q,j as X,v as H,T as le,u as G}from"./index-TO8iFplr.js";const ne={key:0,class:"ms-2 text-muted",style:{"font-weight":"600","font-size":"0.95rem"}},oe={class:"table-responsive",style:{"max-height":"260px","overflow-y":"auto","margin-bottom":"12px"}},ae={class:"table-responsive",style:{"max-height":"260px","overflow-y":"auto"}},de={__name:"deliSearchModal",props:{visible:{type:Boolean,default:!1},deliId:{type:String,default:""}},emits:["close"],setup($,{emit:p}){const C=$,E=p,B=()=>E("close"),V=l=>{if(!l)return"";try{if(typeof l=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l;const e=new Date(l);if(isNaN(e.getTime()))return"";const s=e.getFullYear(),v=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${s}-${v}-${r}`}catch{return""}},g=Y([]),x=Y([]),y=T(""),L=F(()=>{const l=y.value;return(x.value||[]).filter(e=>e.rcvord_id===l)}),i=T(["50px","150px","150px","100px","100px","120px","120px","120px","140px","240px"]),z=j({idx:-1,startX:0,startW:0});function b(l,e){e.preventDefault();const s=parseInt(String(i.value[l]||"").replace(/px$/,""))||0;z.idx=l,z.startX=e.clientX,z.startW=s,document.body.classList.add("resizing"),document.addEventListener("mousemove",I),document.addEventListener("mouseup",S)}function I(l){if(z.idx<0)return;const e=l.clientX-z.startX,r=Math.min(600,Math.max(56,z.startW+e));i.value[z.idx]=`${r}px`}function S(){z.idx=-1,document.body.classList.remove("resizing"),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",S)}K(()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",S)});const W=async l=>{if(!l){g.value=[],x.value=[],y.value="";return}try{const{data:e}=await Q.get(`/api/delis/${encodeURIComponent(l)}`),s=e?.header||{},v=Array.isArray(e?.lines)?e.lines:[],r=new Map;for(const _ of v){const h=_.rcvord_id;!h||r.has(h)||r.set(h,{rcvord_id:_.rcvord_id,emp_nm:_.emp_nm,co_nm:_.co_nm,reg_dt:_.rcv_reg_dt||s.deli_dt,status:_.rcv_deta_st_nm||_.deli_st_nm||"",rcv_rm:_.rcv_rm||""})}g.value=Array.from(r.values()),x.value=v,y.value=g.value[0]?.rcvord_id||""}catch(e){console.error("loadByDeli error",e),g.value=[],x.value=[],y.value=""}};function q(l){y.value=l?.rcvord_id||""}const D=l=>l==null||l===""?"":Number(l).toLocaleString();return te(()=>({v:C.visible,id:C.deliId}),({v:l,id:e})=>{l&&W(e)},{immediate:!0,deep:!1}),(l,e)=>{const s=w("CModalTitle"),v=w("CModalHeader"),r=w("CTableHeaderCell"),_=w("CTableRow"),h=w("CTableHead"),m=w("CTableDataCell"),J=w("CTableBody"),O=w("CTable"),Z=w("CModalBody"),ee=w("CModal");return f(),k(ee,{visible:$.visible,onClose:B,size:"xl"},{default:n(()=>[o(v,{class:"modal-header-custom"},{default:n(()=>[o(s,null,{default:n(()=>[e[10]||(e[10]=a(" 수주 리스트 ",-1)),$.deliId?(f(),M("span",ne," (납품 ID: "+u($.deliId)+") ",1)):U("",!0)]),_:1})]),_:1}),o(Z,null,{default:n(()=>[t("div",oe,[o(O,{bordered:"",hover:"",small:""},{default:n(()=>[o(h,{color:"dark"},{default:n(()=>[o(_,null,{default:n(()=>[o(r,{class:"text-center",style:{width:"50px"}},{default:n(()=>[...e[11]||(e[11]=[a("No",-1)])]),_:1}),o(r,{class:"text-center",style:{width:"160px"}},{default:n(()=>[...e[12]||(e[12]=[a("수주 ID",-1)])]),_:1}),o(r,{class:"text-center",style:{width:"160px"}},{default:n(()=>[...e[13]||(e[13]=[a("수주 담당자",-1)])]),_:1}),o(r,{class:"text-center",style:{width:"200px"}},{default:n(()=>[...e[14]||(e[14]=[a("납품 업체 명",-1)])]),_:1}),o(r,{class:"text-center",style:{width:"160px"}},{default:n(()=>[...e[15]||(e[15]=[a("수주 등록 일자",-1)])]),_:1}),o(r,{class:"text-center",style:{width:"140px"}},{default:n(()=>[...e[16]||(e[16]=[a("수주 상태",-1)])]),_:1}),o(r,{class:"text-center"},{default:n(()=>[...e[17]||(e[17]=[a("비고",-1)])]),_:1})]),_:1})]),_:1}),o(J,null,{default:n(()=>[(f(!0),M(R,null,N(g.value,(d,A)=>(f(),k(_,{key:d.rcvord_id,class:se({"row-active":d.rcvord_id===y.value}),onClick:Be=>q(d),style:{cursor:"pointer"}},{default:n(()=>[o(m,{class:"cell-no"},{default:n(()=>[a(u(A+1),1)]),_:2},1024),o(m,{class:"cell-left"},{default:n(()=>[a(u(d.rcvord_id),1)]),_:2},1024),o(m,{class:"cell-left"},{default:n(()=>[a(u(d.emp_nm),1)]),_:2},1024),o(m,{class:"cell-left"},{default:n(()=>[a(u(d.co_nm),1)]),_:2},1024),o(m,{class:"cell-left"},{default:n(()=>[a(u(V(d.rcv_reg_dt||d.reg_dt)),1)]),_:2},1024),o(m,{class:"cell-left"},{default:n(()=>[a(u(d.status||d.rcv_status||"진행 중"),1)]),_:2},1024),o(m,{class:"cell-left"},{default:n(()=>[a(u(d.rcv_rm),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),g.value.length?U("",!0):(f(),k(_,{key:0},{default:n(()=>[o(m,{colspan:"7",class:"text-center text-muted py-3"},{default:n(()=>[...e[18]||(e[18]=[a("데이터가 없습니다.",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),t("div",ae,[o(O,{bordered:"",hover:"",small:"",style:{"table-layout":"fixed",width:"100%"}},{default:n(()=>[o(h,{color:"dark"},{default:n(()=>[o(_,null,{default:n(()=>[o(r,{class:"text-center th-resizable",style:c({width:i.value[0]})},{default:n(()=>[e[19]||(e[19]=a(" No",-1)),t("span",{class:"col-resizer",onMousedown:e[0]||(e[0]=d=>b(0,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[1]})},{default:n(()=>[e[20]||(e[20]=a(" 제품 명",-1)),t("span",{class:"col-resizer",onMousedown:e[1]||(e[1]=d=>b(1,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[2]})},{default:n(()=>[e[21]||(e[21]=a(" 제품 옵션 명",-1)),t("span",{class:"col-resizer",onMousedown:e[2]||(e[2]=d=>b(2,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[3]})},{default:n(()=>[e[22]||(e[22]=a(" 규격",-1)),t("span",{class:"col-resizer",onMousedown:e[3]||(e[3]=d=>b(3,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[4]})},{default:n(()=>[e[23]||(e[23]=a(" 단위",-1)),t("span",{class:"col-resizer",onMousedown:e[4]||(e[4]=d=>b(4,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[5]})},{default:n(()=>[e[24]||(e[24]=a(" 요청 수량",-1)),t("span",{class:"col-resizer",onMousedown:e[5]||(e[5]=d=>b(5,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[6]})},{default:n(()=>[e[25]||(e[25]=a(" 기납품 수량",-1)),t("span",{class:"col-resizer",onMousedown:e[6]||(e[6]=d=>b(6,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[7]})},{default:n(()=>[e[26]||(e[26]=a(" 미납품 수량",-1)),t("span",{class:"col-resizer",onMousedown:e[7]||(e[7]=d=>b(7,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[8]})},{default:n(()=>[e[27]||(e[27]=a(" 당회 납품 수량",-1)),t("span",{class:"col-resizer",onMousedown:e[8]||(e[8]=d=>b(8,d))},null,32)]),_:1},8,["style"]),o(r,{class:"text-center th-resizable",style:c({width:i.value[9]})},{default:n(()=>[e[28]||(e[28]=a(" 비고",-1)),t("span",{class:"col-resizer",onMousedown:e[9]||(e[9]=d=>b(9,d))},null,32)]),_:1},8,["style"])]),_:1})]),_:1}),o(J,null,{default:n(()=>[(f(!0),M(R,null,N(L.value,(d,A)=>(f(),k(_,{key:d.rcvord_deta_id},{default:n(()=>[o(m,{class:"cell-no",style:c({width:i.value[0]})},{default:n(()=>[a(u(A+1),1)]),_:2},1032,["style"]),o(m,{class:"cell-left",style:c({width:i.value[1]})},{default:n(()=>[a(u(d.prdt_nm),1)]),_:2},1032,["style"]),o(m,{class:"cell-left",style:c({width:i.value[2]})},{default:n(()=>[a(u(d.opt_nm),1)]),_:2},1032,["style"]),o(m,{class:"cell-left",style:c({width:i.value[3]})},{default:n(()=>[a(u(d.spec),1)]),_:2},1032,["style"]),o(m,{class:"cell-left",style:c({width:i.value[4]})},{default:n(()=>[a(u(d.unit),1)]),_:2},1032,["style"]),o(m,{class:"cell-number",style:c({width:i.value[5]})},{default:n(()=>[a(u(D(d.total_req_qty)),1)]),_:2},1032,["style"]),o(m,{class:"cell-number",style:c({width:i.value[6]})},{default:n(()=>[a(u(D(d.delivered_qty)),1)]),_:2},1032,["style"]),o(m,{class:"cell-number",style:c({width:i.value[7]})},{default:n(()=>[a(u(D(Math.max((d.total_req_qty||0)-(d.delivered_qty||0),0))),1)]),_:2},1032,["style"]),o(m,{class:"cell-number",style:c({width:i.value[8]})},{default:n(()=>[a(u(D(d.doc_delivered_qty)),1)]),_:2},1032,["style"]),o(m,{class:"cell-left",style:c({width:i.value[9]})},{default:n(()=>[a(u(d.line_rm),1)]),_:2},1032,["style"])]),_:2},1024))),128)),L.value.length?U("",!0):(f(),k(_,{key:0},{default:n(()=>[o(m,{colspan:"10",class:"text-center text-muted py-3"},{default:n(()=>[...e[29]||(e[29]=[a("데이터가 없습니다.",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})])]),_:1})]),_:1},8,["visible"])}}},re=P(de,[["__scopeId","data-v-35164e22"]]),ie={class:"container-fluid h-100 d-flex flex-column p-3"},ue={class:"search-filter-box mb-2"},ce={class:"row g-3 align-items-end"},me={class:"col-12 col-md-3"},fe={class:"col-12 col-md-3"},pe={class:"col-12 col-md-3"},ve={class:"d-flex align-items-center gap-1"},_e={class:"grid-box flex-grow-1 d-flex flex-column overflow-hidden"},ye={class:"table-wrapper flex-grow-1"},xe={class:"data-table w-100"},be={class:"text-center th-resizable"},ge={class:"th-resizable"},ze={class:"th-resizable"},we={class:"th-resizable"},Me={class:"th-resizable"},Ce={class:"th-resizable"},De={class:"th-resizable action-col"},Le={class:"text-center"},Se=["title"],he=["title"],ke=["title"],Te=["title"],$e=["title"],Ee={class:"text-center"},Ie=["onClick"],Re=15,Ne={__name:"deliSearch",setup($){const p=j({deli_id:"",emp_nm:"",deli_dt_from:"",deli_dt_to:""}),C=T([]),E=T(!1),B=T("");function V(l){B.value=l?.deli_id||"",E.value=!0}const g=T(["40px","140px","140px","140px","110px","300px","110px"]),x=j({idx:-1,startX:0,startW:0});function y(l,e){e.preventDefault();const s=parseInt(String(g.value[l]||"").replace(/px$/,""))||0;x.idx=l,x.startX=e.clientX,x.startW=s,document.body.classList.add("resizing"),document.addEventListener("mousemove",L),document.addEventListener("mouseup",i)}function L(l){if(x.idx<0)return;const e=l.clientX-x.startX,r=Math.min(600,Math.max(56,x.startW+e));g.value[x.idx]=`${r}px`}function i(){x.idx=-1,document.body.classList.remove("resizing"),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",i)}K(()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",i)});const z=F(()=>C.value),b=F(()=>Math.max(0,Re-C.value.length));function I(l){if(!l)return"";try{if(typeof l=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(l))return l;const e=new Date(l);if(isNaN(e.getTime()))return"";const s=e.getFullYear(),v=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${s}-${v}-${r}`}catch{return""}}const S=I;function W(){p.deli_id="",p.emp_nm="",p.deli_dt_from="",p.deli_dt_to="",C.value=[]}async function q(){try{const l={...p},{data:e}=await Q.get("/api/deli-search",{params:l});C.value=Array.isArray(e?.data)?e.data:[]}catch(l){console.error("검색 오류",l),alert("검색 중 오류가 발생했습니다.")}}function D(l){try{return typeof l?.status=="string"&&l.status.trim()!==""?l.status:l?.deli_st_all_j3===!0?"출고 완료":l?.deli_st_all_j3===!1?"진행 중":Array.isArray(l?.deli_sts)&&l.deli_sts.length>0?l.deli_sts.every(e=>e==="J3")?"출고 완료":"진행 중":typeof l?.deli_st=="string"&&l.deli_st==="J3"?"출고 완료":"진행 중"}catch{return"진행 중"}}return(l,e)=>(f(),M("div",ie,[t("div",{class:"d-flex justify-content-end mb-2 gap-2"},[t("button",{class:"btn btn-secondary btn-sm",onClick:W},"초기화"),t("button",{class:"btn btn-secondary btn-sm",onClick:q},"조회")]),t("div",ue,[t("div",ce,[t("div",me,[e[12]||(e[12]=t("label",{class:"form-label"},"납품 ID",-1)),X(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>p.deli_id=s),type:"text",class:"form-control"},null,512),[[H,p.deli_id]])]),t("div",fe,[e[13]||(e[13]=t("label",{class:"form-label"},"납품 담당자",-1)),X(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.emp_nm=s),type:"text",class:"form-control"},null,512),[[H,p.emp_nm]])]),t("div",pe,[e[15]||(e[15]=t("label",{class:"form-label"},"납품 등록 일자",-1)),t("div",ve,[X(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>p.deli_dt_from=s),type:"date",class:"form-control"},null,512),[[H,p.deli_dt_from]]),e[14]||(e[14]=t("span",{class:"mx-1"},"~",-1)),X(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>p.deli_dt_to=s),type:"date",class:"form-control"},null,512),[[H,p.deli_dt_to]])])])])]),t("div",_e,[t("div",ye,[t("table",xe,[t("colgroup",null,[(f(!0),M(R,null,N(g.value,(s,v)=>(f(),M("col",{key:v,style:c({width:s})},null,4))),128))]),t("thead",null,[t("tr",null,[t("th",be,[e[16]||(e[16]=a(" No",-1)),t("span",{class:"col-resizer",onMousedown:e[4]||(e[4]=s=>y(0,s))},null,32)]),t("th",ge,[e[17]||(e[17]=a(" 납품 ID",-1)),t("span",{class:"col-resizer",onMousedown:e[5]||(e[5]=s=>y(1,s))},null,32)]),t("th",ze,[e[18]||(e[18]=a(" 납품 담당자",-1)),t("span",{class:"col-resizer",onMousedown:e[6]||(e[6]=s=>y(2,s))},null,32)]),t("th",we,[e[19]||(e[19]=a(" 납품 등록 일자",-1)),t("span",{class:"col-resizer",onMousedown:e[7]||(e[7]=s=>y(3,s))},null,32)]),t("th",Me,[e[20]||(e[20]=a(" 출고 상태",-1)),t("span",{class:"col-resizer",onMousedown:e[8]||(e[8]=s=>y(4,s))},null,32)]),t("th",Ce,[e[21]||(e[21]=a(" 비고",-1)),t("span",{class:"col-resizer",onMousedown:e[9]||(e[9]=s=>y(5,s))},null,32)]),t("th",De,[e[22]||(e[22]=a(" 납품 상세",-1)),t("span",{class:"col-resizer",onMousedown:e[10]||(e[10]=s=>y(6,s))},null,32)])])]),t("tbody",null,[(f(!0),M(R,null,N(z.value,(s,v)=>(f(),M("tr",{key:v},[t("td",Le,u(v+1),1),t("td",{class:"text-start",title:s.deli_id},u(s.deli_id),9,Se),t("td",{class:"text-start",title:s.emp_nm||s.emp_id},u(s.emp_nm||s.emp_id||""),9,he),t("td",{class:"text-start",title:G(S)(s.deli_dt)},u(G(S)(s.deli_dt)),9,ke),t("td",{class:"text-start",title:D(s)},u(D(s)),9,Te),t("td",{class:"text-start",title:s.rm},u(s.rm||""),9,$e),t("td",Ee,[t("button",{class:"btn btn-secondary btn-sm",onClick:r=>V(s)}," 수주 리스트 ",8,Ie)])]))),128)),(f(!0),M(R,null,N(b.value,s=>(f(),M("tr",{key:"empty-"+s,class:"empty-row"},[...e[23]||(e[23]=[t("td",{colspan:"7"}," ",-1)])]))),128))])])])]),(f(),k(le,{to:"body"},[o(re,{visible:E.value,"deli-id":B.value,onClose:e[11]||(e[11]=s=>E.value=!1)},null,8,["visible","deli-id"])]))]))}},He=P(Ne,[["__scopeId","data-v-7ed5fdf5"]]);export{He as default};
