import{_ as G,r as w,y as J,z as Q,o as et,e as p,c as U,a as b,w as s,d as o,g as u,f as e,B as L,t as c,b as h,x as q,F,h as A,p as W,k as lt,m as B,j as z,v as j,A as st}from"./index-TO8iFplr.js";const ot={class:"search-bar mb-3"},nt={class:"left-controls d-flex gap-2 align-items-center"},at={class:"right-controls"},dt={class:"col-width-scope"},rt={class:"table-responsive",style:{"max-height":"400px","overflow-y":"auto"}},ut=["checked"],it=["checked","onChange"],ct={__name:"prcsModal",props:{isPrcsModalOpen:{type:Boolean,default:!1}},emits:["close","select"],setup(E,{emit:f}){const k=f,a=w([]),_=w([]),I=w(null),K=w(""),m=J({prcs_id:"",prcs_nm:"",searchKind:"all"}),V=Q(()=>a.value.length>0&&a.value.every(t=>_.value.some(l=>l.prcs_id===t.prcs_id&&l.prcs_nm===t.prcs_nm))),M=async()=>{try{const t={prcs_id:"",prcs_nm:"",eqm_grp_nm:"",lead_tm:"",mold_use_at:""};m.searchKind==="prcs_id"?t.prcs_id=m.prcs_id||m.prcs_nm:m.searchKind==="prcs_nm"?t.prcs_nm=m.prcs_nm||m.prcs_id:(t.prcs_id=m.prcs_id,t.prcs_nm=m.prcs_nm);const l=await B.get("/api/prcs",{params:t});a.value=l.data}catch(t){console.error("공정 검색 오류:",t),alert("검색 중 오류가 발생했습니다.")}},P=()=>{m.prcs_id="",m.prcs_nm="",_.value=[]},v=t=>{D(t),R(t)},R=t=>{I.value={...t},K.value=t.prcs_id,console.log("[prcsModal] 단일 공정 선택:",I.value)},D=t=>{const l=_.value.findIndex(g=>g.prcs_id===t.prcs_id&&g.prcs_nm===t.prcs_nm);l>-1?_.value.splice(l,1):_.value.push({...t})},N=t=>{t.target.checked?_.value=a.value.map(l=>({...l})):_.value=[]},O=t=>_.value.some(l=>l.prcs_id===t.prcs_id&&l.prcs_nm===t.prcs_nm),H=()=>{if(_.value.length===0){alert("공정을 선택해주세요.");return}k("select",_.value),d()},d=()=>{P(),a.value=[],_.value=[],k("close")};return et(()=>{}),(t,l)=>{const g=p("CModalTitle"),r=p("CModalHeader"),x=p("CFormInput"),S=p("CButton"),n=p("CTableHeaderCell"),y=p("CTableRow"),T=p("CTableHead"),C=p("CTableDataCell"),X=p("CTableBody"),Y=p("CTable"),Z=p("CModalBody"),tt=p("CModal");return b(),U(tt,{visible:E.isPrcsModalOpen,onClose:d,size:"xl"},{default:s(()=>[o(r,{class:"modal-header-custom"},{default:s(()=>[o(g,null,{default:s(()=>[...l[4]||(l[4]=[u("공정 조회",-1)])]),_:1})]),_:1}),o(Z,null,{default:s(()=>[e("div",ot,[e("div",nt,[l[5]||(l[5]=e("label",{class:"search-label"},"공정 ID",-1)),o(x,{modelValue:m.prcs_id,"onUpdate:modelValue":l[0]||(l[0]=i=>m.prcs_id=i),style:{width:"180px"},onKeyup:L(M,["enter"])},null,8,["modelValue"]),l[6]||(l[6]=e("label",{class:"search-label"},"공정 명",-1)),o(x,{modelValue:m.prcs_nm,"onUpdate:modelValue":l[1]||(l[1]=i=>m.prcs_nm=i),style:{width:"180px"},onKeyup:L(M,["enter"])},null,8,["modelValue"])]),l[9]||(l[9]=e("div",{class:"flex-spacer"},null,-1)),e("div",at,[o(S,{color:"secondary",onClick:P},{default:s(()=>[...l[7]||(l[7]=[u("초기화",-1)])]),_:1}),o(S,{color:"secondary",onClick:M},{default:s(()=>[...l[8]||(l[8]=[u("조회",-1)])]),_:1}),o(S,{color:"secondary",onClick:H,disabled:_.value.length===0},{default:s(()=>[u(" 선택 ("+c(_.value.length)+"건) ",1)]),_:1},8,["disabled"])])]),e("div",dt,[e("div",rt,[o(Y,{bordered:"",hover:"",small:""},{default:s(()=>[o(T,{color:"dark"},{default:s(()=>[o(y,null,{default:s(()=>[o(n,{class:"text-center",style:{width:"50px"}},{default:s(()=>[e("input",{type:"checkbox",checked:V.value,onChange:l[2]||(l[2]=i=>N(i)),class:"form-check-input"},null,40,ut)]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[10]||(l[10]=[u("공정ID",-1)])]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[11]||(l[11]=[u("공정 명",-1)])]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[12]||(l[12]=[u("설비 그룹 명",-1)])]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[13]||(l[13]=[u("금형 사용 유무",-1)])]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[14]||(l[14]=[u("리드 타임",-1)])]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[15]||(l[15]=[u("공정 상태",-1)])]),_:1}),o(n,{class:"text-center"},{default:s(()=>[...l[16]||(l[16]=[u("비고",-1)])]),_:1})]),_:1})]),_:1}),o(X,null,{default:s(()=>[(b(!0),h(F,null,A(a.value,i=>(b(),U(y,{key:i.prcs_id,class:W(["cursor-pointer",{"table-active":_.value.some($=>$.prcs_id===i.prcs_id&&$.prcs_nm===i.prcs_nm)}]),onClick:$=>v(i)},{default:s(()=>[o(C,{onClick:l[3]||(l[3]=lt(()=>{},["stop"]))},{default:s(()=>[e("input",{type:"checkbox",checked:O(i),onChange:$=>D(i),class:"form-check-input"},null,40,it)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.prcs_id),1)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.prcs_nm),1)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.eqm_grp_nm),1)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.mold_use_at_nm||i.mold_use_at),1)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.lead_tm),1)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.st_nm||i.st),1)]),_:2},1024),o(C,null,{default:s(()=>[u(c(i.rm),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),!a.value||a.value.length===0?(b(),U(y,{key:0},{default:s(()=>[o(C,{colspan:"8",class:"text-center text-muted py-3"},{default:s(()=>[...l[17]||(l[17]=[u(" 검색 결과가 없습니다. ",-1)])]),_:1})]),_:1})):q("",!0)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["visible"])}}},_t=G(ct,[["__scopeId","data-v-bc60adf9"]]),pt={class:"search-filter-box mb-2 vars-scope"},mt={class:"table-wrapper"},ft={class:"data-table"},vt=["onClick"],gt={class:"text-center"},bt={key:0},yt=["value"],Ct=["value"],xt=["value"],wt=["value"],kt={class:"d-flex justify-content-end align-items-center gap-2 mb-2"},ht={class:"table-wrapper"},Mt={class:"data-table"},Tt={class:"table-light"},Vt=["onUpdate:modelValue"],Rt={class:"text-center"},St=["onUpdate:modelValue"],Bt={key:0},It={__name:"Routing",setup(E){const f=J({prdt_nm:"",opt_nm:""}),k=w([]),a=w(null),_=Q(()=>({prdt_st_nm:a.value?.prdt_st_nm??"",opt_st_nm:a.value?.opt_st_nm??"",rm:a.value?.rm??"",opt_rm:a.value?.opt_rm??""})),I=async()=>{const d={prdt_nm:"",prdt_opt_id:""};f.prdt_nm&&f.prdt_nm.trim()&&(d.prdt_nm=f.prdt_nm),f.opt_nm&&f.opt_nm.trim()&&(d.prdt_opt_id=f.opt_nm);try{const t=await B.get("/api/routing/prdts",{params:d});k.value=t.data}catch(t){console.error("검색 오류:",t)}},K=async()=>{if(a.value&&v.value.length)try{const d=await B.post("/api/routing/deta/save",{prdt_id:a.value.prdt_id,prdt_opt_id:a.value.prdt_opt_id,rows:v.value.map(t=>({prcs_routing_deta_id:t.prcs_routing_deta_id||"",prcs_id:t.prcs_id,prcs_ord:t.prcs_ord,prcs_reg_dt:t.prcs_reg_dt||new Date().toISOString().split("T")[0]}))});await R(a.value.prdt_id,a.value.prdt_opt_id),d?.data?.success?alert("저장에 성공 하였습니다."):alert("저장에 실패했습니다.")}catch(d){console.error("행 저장 오류:",d)}},m=()=>{console.log("[routing]] 공정 조회 모달 열기"),V.value=!0},V=w(!1),M=()=>{V.value=!1,console.log("[routing]] 공정 조회 모달 닫기")};function P(){k.value=[],a.value=null,f.prdt_nm="",f.opt_nm="",a.value=null,v.value=[]}const v=w([]),R=async(d,t)=>{try{const l=await B.get("/api/prdt/prcs",{params:{prdt_id:d,prdt_opt_id:t}});v.value=l.data}catch(l){console.error("라우팅 정보 조회 오류:",l),v.value=[]}},D=d=>{const t=d.target.checked;v.value.forEach(l=>l.selected=t)},N=d=>{a.value={...d},R(d.prdt_id,d.prdt_opt_id)},O=d=>{if(console.log("[routing] 선택된 공정목록:",d),!a.value){alert("제품을 먼저 선택하세요.");return}const t=r=>`${r.prcs_id}||${r.prcs_nm}`,l=new Set(v.value.map(r=>t(r))),g=d.filter(r=>!l.has(t(r))).map((r,x)=>({prcs_routing_deta_id:"",prcs_id:r.prcs_id,prcs_nm:r.prcs_nm,eqm_grp_nm:r.eqm_grp_nm,lead_tm:r.lead_tm,mold_use_at:r.mold_use_at,mold_use_at_nm:r.mold_use_at_nm||r.mold_use_at,st:r.st,st_nm:r.st_nm||r.st,prcs_reg_dt:r.prcs_reg_dt||new Date().toISOString().split("T")[0],prcs_ord:v.value.length+1+x,selected:!1}));g.length>0?v.value.push(...g):console.log("[routing] 추가할 공정이 없습니다(중복 또는 빈값)."),M(),console.log("[routing] 라우팅정보 갱신 후:",v.value)},H=async()=>{if(!a.value||!confirm("삭제 하시겠습니까?"))return;const d=v.value.filter(t=>t.selected).map(t=>({prcs_routing_deta_id:t.prcs_routing_deta_id||"",prcs_id:t.prcs_id,prcs_ord:t.prcs_ord}));if(d.length!==0)try{await B.post("/api/routing/deta/delete",{prdt_id:a.value.prdt_id,prdt_opt_id:a.value.prdt_opt_id,rows:d}),R(a.value.prdt_id,a.value.prdt_opt_id)}catch(t){console.error("행 삭제 오류:",t)}};return(d,t)=>{const l=p("CCol"),g=p("CRow"),r=p("CCard"),x=p("CButton"),S=p("CContainer");return b(),U(S,{fluid:"",class:"routing-page-container h-100 d-flex flex-column p-3"},{default:s(()=>[e("div",{class:"d-flex justify-content-end mb-2 gap-2"},[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:I},"조회"),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:P},"초기화")]),e("div",pt,[o(g,{class:"g-3"},{default:s(()=>[o(l,{md:6},{default:s(()=>[t[3]||(t[3]=e("label",{class:"form-label"},"제품 명",-1)),z(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=n=>f.prdt_nm=n),placeholder:"제품명을 입력하세요"},null,512),[[j,f.prdt_nm]])]),_:1}),o(l,{md:6},{default:s(()=>[t[4]||(t[4]=e("label",{class:"form-label"},"옵션 명",-1)),z(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=n=>f.opt_nm=n),placeholder:"옵션명을 입력하세요"},null,512),[[j,f.opt_nm]])]),_:1})]),_:1})]),o(g,{class:"flex-grow-1 overflow-hidden g-2"},{default:s(()=>[o(l,{md:"5",class:"d-flex flex-column overflow-hidden"},{default:s(()=>[o(r,{class:"p-3 flex-grow-1 d-flex flex-column"},{default:s(()=>[e("div",mt,[e("table",ft,[t[6]||(t[6]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{style:{width:"60px"}},"No"),e("th",null,"제품ID"),e("th",null,"제품명"),e("th",null,"옵션ID"),e("th",null,"옵션명")])],-1)),e("tbody",null,[(b(!0),h(F,null,A(k.value,(n,y)=>(b(),h("tr",{key:y,onClick:T=>N(n),class:W({"selected-row":a.value&&a.value.prdt_id===n.prdt_id&&a.value.prdt_opt_id===n.prdt_opt_id}),style:{cursor:"pointer"}},[e("td",gt,c(y+1),1),e("td",null,c(n.prdt_id),1),e("td",null,c(n.prdt_nm),1),e("td",null,c(n.prdt_opt_id),1),e("td",null,c(n.opt_nm),1)],10,vt))),128)),k.value.length===0?(b(),h("tr",bt,[...t[5]||(t[5]=[e("td",{colspan:"5",class:"text-center text-muted"},"검색 결과가 없습니다.",-1)])])):q("",!0)])])])]),_:1})]),_:1}),o(l,{md:"7",class:"d-flex flex-column justify-content-between overflow-hidden"},{default:s(()=>[o(r,{class:"p-3 mb-3 flex-grow-1 details-card",style:{"flex-basis":"40%"}},{default:s(()=>[e("div",null,[o(g,null,{default:s(()=>[o(l,{md:"6",class:"mb-2"},{default:s(()=>[t[7]||(t[7]=e("label",{class:"form-label fw-semibold",style:{"font-size":"0.85rem"}},"제품 상태",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:_.value.prdt_st_nm,readonly:""},null,8,yt)]),_:1}),o(l,{md:"6",class:"mb-2"},{default:s(()=>[t[8]||(t[8]=e("label",{class:"form-label fw-semibold",style:{"font-size":"0.85rem"}},"옵션 상태",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:_.value.opt_st_nm,readonly:""},null,8,Ct)]),_:1})]),_:1}),o(g,null,{default:s(()=>[o(l,{md:"6",class:"mb-2"},{default:s(()=>[t[9]||(t[9]=e("label",{class:"form-label fw-semibold",style:{"font-size":"0.85rem"}},"제품 비고",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:_.value.rm,readonly:""},null,8,xt)]),_:1}),o(l,{md:"6",class:"mb-2"},{default:s(()=>[t[10]||(t[10]=e("label",{class:"form-label fw-semibold",style:{"font-size":"0.85rem"}},"옵션 비고",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:_.value.opt_rm,readonly:""},null,8,wt)]),_:1})]),_:1})])]),_:1}),e("div",kt,[o(x,{color:"secondary",size:"sm",onClick:m},{default:s(()=>[...t[11]||(t[11]=[u(" 공정검색 ",-1)])]),_:1}),o(_t,{isPrcsModalOpen:V.value,onClose:M,onSelect:O},null,8,["isPrcsModalOpen"]),o(x,{color:"danger",size:"sm",onClick:H},{default:s(()=>[...t[12]||(t[12]=[u("행 삭제",-1)])]),_:1}),o(x,{color:"secondary",size:"sm",onClick:K},{default:s(()=>[...t[13]||(t[13]=[u("저장",-1)])]),_:1})]),o(r,{class:"p-3 flex-grow-1",style:{"flex-basis":"60%"}},{default:s(()=>[t[23]||(t[23]=e("h6",{class:"fw-bold mb-3 d-flex justify-content-between align-items-center"},null,-1)),e("div",ht,[e("table",Mt,[e("thead",Tt,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",onChange:t[2]||(t[2]=n=>D(n))},null,32)]),t[14]||(t[14]=e("th",null,"No",-1)),t[15]||(t[15]=e("th",null,"공정ID",-1)),t[16]||(t[16]=e("th",null,"공정 명",-1)),t[17]||(t[17]=e("th",null,"설비 그룹 명",-1)),t[18]||(t[18]=e("th",null,"금형 사용 유무",-1)),t[19]||(t[19]=e("th",null,"공정 상태",-1)),t[20]||(t[20]=e("th",null,"리드 타임",-1)),t[21]||(t[21]=e("th",null,"공정 순서",-1))])]),e("tbody",null,[(b(!0),h(F,null,A(v.value,(n,y)=>(b(),h("tr",{key:y},[e("td",null,[z(e("input",{type:"checkbox","onUpdate:modelValue":T=>n.selected=T},null,8,Vt),[[st,n.selected]])]),e("td",Rt,c(y+1),1),e("td",null,c(n.prcs_id),1),e("td",null,c(n.prcs_nm),1),e("td",null,c(n.eqm_grp_nm),1),e("td",null,c(n.mold_use_at_nm||n.mold_use_at),1),e("td",null,c(n.st_nm||n.st),1),e("td",null,c(n.lead_tm),1),e("td",null,[z(e("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":T=>n.prcs_ord=T,style:{width:"70px","text-align":"right"}},null,8,St),[[j,n.prcs_ord]])])]))),128)),a.value?q("",!0):(b(),h("tr",Bt,[...t[22]||(t[22]=[e("td",{colspan:"9",class:"text-muted text-center"},"라우팅 정보가 없습니다.",-1)])]))])])])]),_:1})]),_:1})]),_:1})]),_:1})}}},Dt=G(It,[["__scopeId","data-v-e75163fe"]]);export{Dt as default};
