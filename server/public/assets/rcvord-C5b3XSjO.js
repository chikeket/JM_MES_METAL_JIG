import{_ as le,r as N,s as de,q as se,o as ie,e as y,c as X,a as f,w as a,d as r,g as i,f as t,b as k,x as ue,F as z,h as Z,u as ee,t as c,m as P,i as ce,y as pe,z as me,j as x,v as q,A as te,p as L,B as A,k as _e,C as ve}from"./index-TO8iFplr.js";import{r as fe}from"./rcvordModalTwo-mV3yCMvt.js";const be={class:"search-bar mb-3"},ye={class:"left-controls d-flex gap-2 align-items-center"},ke={class:"right-controls"},ge={class:"col-width-scope"},Ce={class:"table-responsive",style:{"max-height":"400px","overflow-y":"auto"}},xe={__name:"rcvordModalOne",props:{visible:{type:Boolean,default:!1}},emits:["close","select"],setup(j,{emit:B}){const n=j,O=B,m=N("");let T=de([]);const V=()=>{O("close")},Y=d=>d==null?"":Number(d).toLocaleString(),D=d=>{if(!d)return"";try{if(typeof d=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(d))return d;const o=new Date(d);if(isNaN(o.getTime()))return"";const S=o.getFullYear(),M=String(o.getMonth()+1).padStart(2,"0"),I=String(o.getDate()).padStart(2,"0");return`${S}-${M}-${I}`}catch{return""}},g=async()=>{try{const d={},o=(m.value||"").trim();o&&(d.rcvord_id=o);const{data:S}=await P.get("/api/rcvords",{params:d});T.value=Array.isArray(S)?S:[]}catch(d){console.error("rcvords fetch error",d)}},_=async()=>{await g()},Q=async()=>{m.value="",await g()},U=d=>{O("select",d),V()};return se(()=>n.visible,d=>{d&&(m.value="",g())}),ie(()=>{n.visible&&!T.value.length&&g()}),(d,o)=>{const S=y("CModalTitle"),M=y("CModalHeader"),I=y("CFormInput"),$=y("CButton"),h=y("CTableHeaderCell"),E=y("CTableRow"),G=y("CTableHead"),C=y("CTableDataCell"),H=y("CTableBody"),K=y("CTable"),F=y("CModalBody"),R=y("CModal");return f(),X(R,{visible:j.visible,onClose:V,size:"xl"},{default:a(()=>[r(M,{class:"modal-header-custom"},{default:a(()=>[r(S,null,{default:a(()=>[...o[1]||(o[1]=[i("수주 조회",-1)])]),_:1})]),_:1}),r(F,null,{default:a(()=>[t("div",be,[t("div",ye,[o[2]||(o[2]=t("label",{class:"search-label"},"수주 ID",-1)),r(I,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=p=>m.value=p),style:{width:"200px"}},null,8,["modelValue"])]),o[5]||(o[5]=t("div",{class:"flex-spacer"},null,-1)),t("div",ke,[r($,{color:"secondary",onClick:_},{default:a(()=>[...o[3]||(o[3]=[i("조회",-1)])]),_:1}),r($,{color:"secondary",onClick:Q},{default:a(()=>[...o[4]||(o[4]=[i("초기화",-1)])]),_:1})])]),t("div",ge,[t("div",Ce,[r(K,{bordered:"",hover:"",small:""},{default:a(()=>[r(G,{color:"dark"},{default:a(()=>[r(E,null,{default:a(()=>[r(h,{class:"text-center",style:{width:"50px"}},{default:a(()=>[...o[6]||(o[6]=[i("No",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[7]||(o[7]=[i("수주 ID",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[8]||(o[8]=[i("납품 업체 명",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[9]||(o[9]=[i("수주 담당자",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[10]||(o[10]=[i("총 요청 수량",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[11]||(o[11]=[i("수주 등록 일자",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[12]||(o[12]=[i("수주 상태",-1)])]),_:1}),r(h,{class:"text-center"},{default:a(()=>[...o[13]||(o[13]=[i("비고",-1)])]),_:1})]),_:1})]),_:1}),r(H,null,{default:a(()=>[(f(!0),k(z,null,Z(ee(T),(p,J)=>(f(),X(E,{key:p.rcvord_id,onDblclick:w=>U(p),style:{cursor:"pointer"}},{default:a(()=>[r(C,{class:"cell-no"},{default:a(()=>[i(c(J+1),1)]),_:2},1024),r(C,{class:"cell-left"},{default:a(()=>[i(c(p.rcvord_id),1)]),_:2},1024),r(C,{class:"cell-left"},{default:a(()=>[i(c(p.co_nm),1)]),_:2},1024),r(C,{class:"cell-left"},{default:a(()=>[i(c(p.emp_nm),1)]),_:2},1024),r(C,{class:"cell-number"},{default:a(()=>[i(c(Y(p.total_qty)),1)]),_:2},1024),r(C,{class:"cell-left"},{default:a(()=>[i(c(D(p.reg_dt)),1)]),_:2},1024),r(C,{class:"cell-left"},{default:a(()=>[i(c(p.status),1)]),_:2},1024),r(C,{class:"cell-left"},{default:a(()=>[i(c(p.rm),1)]),_:2},1024)]),_:2},1032,["onDblclick"]))),128)),ee(T).length?ue("",!0):(f(),X(E,{key:0},{default:a(()=>[r(C,{colspan:"8",class:"text-center text-muted py-3"},{default:a(()=>[...o[14]||(o[14]=[i(" 데이터가 없습니다. ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["visible"])}}},Ne=le(xe,[["__scopeId","data-v-69e44c11"]]),Ie={class:"global-toolbar vars-scope"},he={class:"rcvord-page vars-scope"},De={class:"order-header card-like"},Se={class:"form-grid"},qe={class:"field"},Ve={class:"field"},$e={class:"field"},Te={class:"field"},Me={class:"field"},Be={class:"field field-col-span"},Qe={class:"table-wrapper table-wrapper-expanded"},Ue={class:"data-grid"},Re={class:"chk-col"},Ae={class:"text-center"},Ee=["onUpdate:modelValue"],Fe={class:"cell-no"},Le={class:"cell-left"},Oe=["title"],He={class:"cell-left"},Ke=["title"],ze={class:"cell-left"},Pe=["title"],je={class:"cell-left"},Ye=["title"],Ge=["onClick"],Je={key:1,class:"input-like input-like--compact input-like--number"},We={class:"cell-left"},Xe=["title"],Ze=["onClick"],we={key:1,class:"input-like input-like--compact"},et=["title"],tt=["title"],lt=["onClick"],st=["onKeyup"],nt={key:1,class:"input-like input-like--textarea"},ot=["title"],at=15,rt={__name:"rcvord",setup(j){const B=ce(),n=pe({orderId:"",vendorName:"",owner:"",empId:"",status:"",statusCode:"",orderDate:"",note:""});let O=1;const m=N([]);function T(s={}){return{frontTempId:O++,rcvord_deta_id:null,prdt_id:null,prdt_opt_id:null,productName:"",optionName:"",requestQty:0,spec:"",unit:"",producible:"",paprd_dt:"",st:"",statusName:"",remark:"",_selected:!1,...s}}const V=N(!1);function Y(){m.value.forEach(s=>s._selected=V.value)}const D=N(null),g=N(""),_=N(""),Q=N([]),U=N([]),d=N([]);function o(s,e){["requestQty","remark","paprd_dt"].includes(e)&&(D.value=s,g.value=e,e==="requestQty"?_.value=String(s.requestQty):e==="remark"?_.value=s.remark:e==="paprd_dt"&&(_.value=s.paprd_dt||""),ve(()=>{if(e==="requestQty"&&Q.value?.length){const l=Q.value[Q.value.length-1];l&&l.focus()}else if(e==="remark"&&U.value?.length){const l=U.value[U.value.length-1];l&&l.focus()}else if(e==="paprd_dt"&&d.value?.length){const l=d.value[d.value.length-1];l&&l.focus()}}))}function S(s){return D.value===s}function M(s,e){return S(s)&&g.value===e}function I(){if(D.value){if(g.value==="requestQty"){const s=Number(_.value.replace(/[,\s]/g,""));D.value.requestQty=Number.isFinite(s)?s:0}else g.value==="remark"?D.value.remark=_.value.trim():g.value==="paprd_dt"&&(D.value.paprd_dt=_.value||"");$()}}function $(){D.value=null,g.value="",_.value=""}const h=me(()=>Math.max(0,at-m.value.length));function E(s){if(s==null||s==="")return"";const e=Number(s);return Number.isFinite(e)?e.toLocaleString():s}function G(){p.value=!0}function C(){m.value=m.value.filter(s=>!s._selected),V.value=!1}function H(){m.value=[],V.value=!1,$()}function K(){n.orderId||(!n.owner&&B.user&&(n.owner=B.user.emp_nm||"",n.empId=B.user.emp_id||""),n.orderDate||(n.orderDate=new Date().toISOString().slice(0,10)))}function F(){Object.assign(n,{orderId:"",vendorName:"",owner:"",empId:"",status:"",statusCode:"",orderDate:new Date().toISOString().slice(0,10),note:""}),K(),H()}se(()=>B.user,()=>{K()},{immediate:!0});const R=N(!1),p=N(!1);function J(){R.value=!0}async function w(s){try{const e=s.rcvord_id;if(!e)return;const{data:l}=await P.get(`/api/rcvords/${e}`),{header:b,lines:v}=l||{};n.orderId=b?.rcvord_id||"",n.vendorName=b?.co_nm||"",n.owner=b?.emp_nm||b?.emp_id||"",n.empId=b?.emp_id||"",n.status=b?.status||"",n.statusCode=b?.st||"",n.orderDate=b?.reg_dt?W(b.reg_dt):"",n.note=b?.rm||"",m.value=Array.isArray(v)?v.map(u=>T({rcvord_deta_id:u.rcvord_deta_id||null,prdt_id:u.prdt_id||null,prdt_opt_id:u.prdt_opt_id||null,productName:u.prdt_nm||u.prdt_id||"",optionName:u.opt_nm&&u.opt_nm.trim()?u.opt_nm:u.prdt_opt_id||"-",requestQty:u.rcvord_qy||0,spec:u.spec||"",unit:u.unit||"",producible:u.prdt_st_nm||u.prdt_st||"",paprd_dt:u.paprd_dt?W(u.paprd_dt):"",st:u.st||"",statusName:u.deta_st_nm||"",remark:u.rm||""})):[]}catch(e){console.error("order detail fetch error",e)}finally{R.value=!1}}function W(s){if(!s)return"";try{if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(s))return s;const e=new Date(s);if(isNaN(e.getTime()))return"";const l=e.getFullYear(),b=String(e.getMonth()+1).padStart(2,"0"),v=String(e.getDate()).padStart(2,"0");return`${l}-${b}-${v}`}catch{return""}}function ne(){const s=ae();P.post("/api/rcvords/save",s).then(e=>{const l=e?.data?.rcvord_id;l&&(n.orderId=l),alert("저장 성공"),F()}).catch(e=>{console.error("저장 실패",e),alert("저장 실패: "+(e?.response?.data?.error||e.message))})}function oe(){if(!n.orderId){alert("삭제할 수주가 없습니다.");return}confirm(`수주 ${n.orderId} 를 삭제할까요?`)&&P.delete(`/api/rcvords/${n.orderId}`).then(()=>{alert("삭제 성공"),F()}).catch(s=>{console.error("삭제 실패",s),alert("삭제 실패: "+(s?.response?.data?.error||s.message))})}function ae(){const s={rcvord_id:n.orderId||"",co_id:null,emp_id:null,co_nm:n.vendorName?n.vendorName.trim():"",emp_nm:n.owner?n.owner.trim():"",reg_dt:n.orderDate||W(new Date),st:n.statusCode||"J2",rm:n.note||null},e=m.value.map(l=>({rcvord_deta_id:l.rcvord_deta_id||null,prdt_id:l.prdt_id||null,prdt_opt_id:l.prdt_opt_id||null,rcvord_qy:Number(l.requestQty)||0,paprd_dt:l.paprd_dt||null,rm:l.remark||null}));return{header:s,lines:e}}async function re(s){try{const e=T({prdt_id:s.prdt_id,prdt_opt_id:s.prdt_opt_id,productName:s.prdt_nm,optionName:s.opt_nm||"",spec:s.spec,unit:s.unit,producible:s.prdt_st_nm||s.prdt_st,requestQty:0,paprd_dt:"",remark:s.rm||""});m.value.push(e)}catch(e){console.error("product select error",e)}finally{p.value=!1}}return(s,e)=>(f(),k(z,null,[t("div",Ie,[t("div",{class:"toolbar-buttons"},[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:F},"신규"),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:J},"수주 조회"),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:ne},"저장"),t("button",{class:"btn btn-sm btn-outline-danger",onClick:oe},"삭제")]),r(Ne,{visible:R.value,onClose:e[0]||(e[0]=l=>R.value=!1),onSelect:w},null,8,["visible"]),r(fe,{visible:p.value,onClose:e[1]||(e[1]=l=>p.value=!1),onSelect:re},null,8,["visible"])]),t("div",he,[t("div",De,[t("div",Se,[t("div",qe,[e[12]||(e[12]=t("label",null,"수주 ID",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=l=>n.orderId=l),readonly:""},null,512),[[q,n.orderId]])]),t("div",Ve,[e[13]||(e[13]=t("label",null,"납품업체 명",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>n.vendorName=l),required:""},null,512),[[q,n.vendorName]])]),t("div",$e,[e[14]||(e[14]=t("label",null,"수주 담당자",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>n.owner=l),required:""},null,512),[[q,n.owner]])]),t("div",Te,[e[15]||(e[15]=t("label",null,"수주 상태",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=l=>n.status=l),readonly:""},null,512),[[q,n.status]])]),t("div",Me,[e[16]||(e[16]=t("label",null,"수주 등록 일자",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=l=>n.orderDate=l)},null,512),[[q,n.orderDate]])]),t("div",Be,[e[17]||(e[17]=t("label",null,"비고",-1)),x(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>n.note=l)},null,512),[[q,n.note]])])])]),t("div",{class:"sub-toolbar"},[t("div",{class:"sub-toolbar-buttons"},[t("button",{class:"btn btn-sm btn-outline-secondary",onClick:H},"초기화"),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:G},"제품 추가"),t("button",{class:"btn btn-sm btn-outline-danger",onClick:C}," 선택 제품 삭제 ")])]),t("div",Qe,[t("table",Ue,[t("thead",null,[t("tr",null,[t("th",Re,[x(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>V.value=l),onChange:Y},null,544),[[te,V.value]])]),e[18]||(e[18]=t("th",{class:"no-col"},"No",-1)),e[19]||(e[19]=t("th",{class:"prod-col"},"제품 명",-1)),e[20]||(e[20]=t("th",{class:"opt-col"},"제품 옵션 명",-1)),e[21]||(e[21]=t("th",{class:"spec-col"},"규격",-1)),e[22]||(e[22]=t("th",{class:"unit-col"},"단위",-1)),e[23]||(e[23]=t("th",{class:"qty-col"},"요청 수량",-1)),e[24]||(e[24]=t("th",{class:"producible-col"},"생산 가능 여부",-1)),e[25]||(e[25]=t("th",{class:"due-date-col"},"납품 예정 일자",-1)),e[26]||(e[26]=t("th",{class:"st-col"},"출고 상태",-1)),e[27]||(e[27]=t("th",{class:"remark-col"},"비고",-1))])]),t("tbody",null,[(f(!0),k(z,null,Z(m.value,(l,b)=>(f(),k("tr",{key:l.rcvord_deta_id||l.frontTempId,class:L({editing:S(l)})},[t("td",Ae,[x(t("input",{type:"checkbox","onUpdate:modelValue":v=>l._selected=v},null,8,Ee),[[te,l._selected]])]),t("td",Fe,c(b+1),1),t("td",Le,[t("span",{class:"cell-text",title:l.productName},c(l.productName),9,Oe)]),t("td",He,[t("span",{class:"cell-text",title:l.optionName},c(l.optionName),9,Ke)]),t("td",ze,[t("span",{class:"cell-text",title:l.spec},c(l.spec),9,Pe)]),t("td",je,[t("span",{class:"cell-text",title:l.unit},c(l.unit),9,Ye)]),t("td",{class:"cell-number editable",onClick:v=>o(l,"requestQty")},[M(l,"requestQty")?x((f(),k("input",{key:0,ref_for:!0,ref_key:"qtyInputs",ref:Q,type:"text","onUpdate:modelValue":e[9]||(e[9]=v=>_.value=v),onKeyup:[A(I,["enter"]),A($,["esc"])],onBlur:I,class:"editor-input text-end",placeholder:"입력"},null,544)),[[q,_.value]]):(f(),k("div",Je,[t("span",{class:L(["value",{"placeholder-text":!l.requestQty}])},c(l.requestQty?E(l.requestQty):"입력"),3)]))],8,Ge),t("td",We,[t("span",{class:"cell-text",title:l.producible},c(l.producible),9,Xe)]),t("td",{class:"cell-left editable",onClick:v=>o(l,"paprd_dt")},[M(l,"paprd_dt")?x((f(),k("input",{key:0,ref_for:!0,ref_key:"dueDateInputs",ref:d,type:"date","onUpdate:modelValue":e[10]||(e[10]=v=>_.value=v),onKeyup:[A(I,["enter"]),A($,["esc"])],onBlur:I,class:"editor-input",placeholder:"입력"},null,544)),[[q,_.value]]):(f(),k("div",we,[t("span",{class:L(["value",{"placeholder-text":!l.paprd_dt}]),title:l.paprd_dt||""},c(l.paprd_dt||"입력"),11,et)]))],8,Ze),t("td",{class:L(["cell-left status-cell",{empty:!(l.statusName||"").trim()}])},[t("span",{class:"cell-text",title:l.statusName||""},c(l.statusName||""),9,tt)],2),t("td",{class:"cell-left editable",onClick:v=>o(l,"remark")},[M(l,"remark")?x((f(),k("textarea",{key:0,ref_for:!0,ref_key:"remarkInputs",ref:U,"onUpdate:modelValue":e[11]||(e[11]=v=>_.value=v),onKeyup:[A(_e(I,["exact","prevent"]),["enter"]),A($,["esc"])],onBlur:I,class:"editor-textarea",placeholder:"입력"},null,40,st)),[[q,_.value]]):(f(),k("div",nt,[t("div",{class:L(["ellipsis",{"placeholder-text":!l.remark}]),title:l.remark||""},c(l.remark||"입력"),11,ot)]))],8,lt)],2))),128)),(f(!0),k(z,null,Z(h.value,l=>(f(),k("tr",{key:"empty-"+l,class:"empty-row"},[...e[28]||(e[28]=[t("td",{colspan:"11"}," ",-1)])]))),128))])])])])],64))}},ut=le(rt,[["__scopeId","data-v-5a5d7560"]]);export{ut as default};
